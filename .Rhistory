# get rid of consecutives ...
df2 <- df[only2consec(df$pdead), ]
# define three mortality categories, 0 for no dead, 100 for all dead, and 50 from any proportional mortality
df2$mcat <- rep(50, length(df2$pdead))
df2$mcat[df2$ntot==df2$nalive] <- 0
df2$mcat[df2$ntot==df2$ndead] <- 100
# if we have < 3 observations or we only have all dead or all survive, we can't estimate LCs
if((var(df2$mcat) < 0.00000001 & df2$mcat[1] != 50) | dim(df2)[1] < 3) {
estLCs <- NA
chi <- NA
} else {
# A 2. Plot doses against % effect on logarithmic-probability paper
df2$x <- log10(df2$dose)
df2$y <- probit(df2$pdead)
yr <- probit(c(0.001, 0.999))
df2$y[df2$pdead==0] <- yr[1]
df2$y[df2$pdead==1] <- yr[2]
# calculate starting values
pms <- sum(df2$mcat==50)
svp <- list(sv=c(NA, NA), p=NA)
# fit line to partial mortalities alone
if(pms > 1) {
df3 <- df2[df2$mcat==50, ]
svp <- startvals(df3)
}
# fit line to partial mortalities with last 0% and first 100%
if(pms==1 | is.na(svp$p)) {
df3 <- rbind(df2[df2$mcat==0, ][sum(df2$mcat==0), ], df2[df2$mcat==50, ], df2[df2$mcat==100, ][1, ])
svp <- startvals(df3)
}
# fit line to all the data
if(pms < 1 | is.na(svp$p)) {
svp <- startvals(df2)
}
# fit line to first 0% and last 100% alone
if(is.na(svp$p)) {
df3 <- rbind(df2[df2$mcat==0, ][1, ], df2[df2$mcat==100, ][sum(df2$mcat==100), ])
svp <- startvals(df3)
}
# find the LC50 and LC999 (on the log10 scale) that give the lowest p value for the chi-square
bestLC <- optim(par=svp$sv, fn=pchi.from.LC, data=df2)
estLCs <- bestLC$par
chi <- pchi.from.LC(estLCs, data=df2, list=T)
if(!is.na(chi$p) & chi$p < 0.05) print("Chi squared test indicates poor fit.")
rm(pms, svp, df3, bestLC)
}
# L-W
slope <- as.numeric(probit(0.999) / (estLCs[2] - estLCs[1]))
int <- -slope*estLCs[1]
LC25 <- as.numeric(10^( (probit(0.25) - int) / slope ))
LC50 <- as.numeric(10^estLCs[1])
LC99.9 <- as.numeric(10^estLCs[2])
# Straight probit analysis - best line, LC99.9
sel <- dose > 0
pdf <- data.frame(tfm.dose=dose, n.larv=ntot, n.dead=ndead, prop.dead=ndead/ntot)[sel, ]
probitfit <- glm(cbind(n.dead, n.larv-n.dead) ~ log10(tfm.dose), family=binomial(link=probit), data=pdf)
probitcoef <- coef(summary(probitfit))
logD25 <- dose.p(probitfit, cf=1:2, p=0.25)
D25 <- 10^c(logD25 + c(0, -1.96, 1.96) * attr(logD25, "SE"))
names(D25) <- c("D25", "lower", "upper")
logD50 <- dose.p(probitfit, cf=1:2, p=0.5)
D50 <- 10^c(logD50 + c(0, -1.96, 1.96) * attr(logD50, "SE"))
names(D50) <- c("D50", "lower", "upper")
logD999 <- dose.p(probitfit, cf=1:2, p=0.999)
D999 <- 10^c(logD999 + c(0, -1.96, 1.96) * attr(logD999, "SE"))
names(D999) <- c("D999", "lower", "upper")
Pint <- coef(summary(probitfit))[1, 1] + c(0, -1.96, 1.96)*coef(summary(probitfit))[1, 2]
Pslope <- coef(summary(probitfit))[2, 1] + c(0, -1.96, 1.96)*coef(summary(probitfit))[2, 2]
dfout <- data.frame(
param = rep(c("LC25", "LC50", "LC99.9", "intercept", "slope"), 2),
method = rep(c("Auto Litchfield-Wilcoxon", "Probit"), c(5, 5)),
estimate = c(LC25, LC50, LC99.9, int, slope, D25[1], D50[1], D999[1], Pint[1], Pslope[1]),
lower95ci = c(NA, NA, NA, NA, NA, D25[2], D50[2], D999[2], Pint[2], Pslope[2]),
upper95ci = c(NA, NA, NA, NA, NA, D25[3], D50[3], D999[3], Pint[3], Pslope[3])
)
if(plot) {
# LW
LC0.1 <- as.numeric(10^( (probit(0.001) - int) / slope ))
pred <- inv.probit(int + slope*df2$x)
cor.pred <- ifelse(df2$mcat==50, pred, correct.val(pred))
# probit
logd001 <- dose.p(probitfit, cf=1:2, p=0.001)
D001 <- 10^c(logd001 + c(0, -1.96, 1.96) * attr(logd001, "SE"))
names(D001) <- c("D001", "lower", "upper")
#windows(h=6.5, w=6.5)
par(mar=c(4.5, 4.5, 2, 1), cex=1.5, las=1)
plot(df2$x, df2$y, type="n", axes=F, xlim=range(c(df2$x, log10(LC0.1), log10(LC99.9)), na.rm=T),
ylim=probit(c(0.001, 0.999)), xlab="Dose", ylab="Mortality  (%)", main=description)
# background grid and axes
tikz1 <- pretty(10^(range(c(df2$x, log10(LC0.1), log10(LC99.9)), na.rm=T)))
tikz3 <- c(seq(0.1, 0.9, 0.1), seq(1, 9, 1), seq(10, 90, 10), seq(91, 99, 1), seq(99.1, 99.9, 0.1))
tikz4 <- c(0.1, 1, 10, 50, 90, 99, 99.9)
tikz5 <- c(25, 50, 99.9)
abline(v=log10(tikz1), lwd=2, col="lightgray")
axis(1, at=log10(tikz1), labels=tikz1)
abline(h=probit(tikz3/100), col="lightgray")
abline(h=probit(tikz4/100), lwd=2, col="lightgray")
abline(h=probit(tikz5/100), lwd=2, col="brown")
axis(2, at=probit(tikz4/100), labels=tikz4)
box()
# LW line - use a dashed line for "poor fits" as defined by chi squared test
if(!is.na(chi$p) & chi$p < 0.05) {
abline(int, slope, lwd=3, lty=2)
} else {
abline(int, slope, lwd=3)
}
# probit line
lines(log10(c(D001[1], D999[1])), probit(c(0.001, 0.999)), lwd=3, lty=3, col="red")
# LW 99.9 point
points(log10(LC99.9), probit(0.999), pch=3, lwd=3, cex=1.7)
# observed points
points(df2$x[df2$mcat==50], df2$y[df2$mcat==50], pch=16, cex=1.5)
points(df2$x[df2$mcat!=50], df2$y[df2$mcat!=50], lwd=3, cex=1.5)
# notes on graph
par(cex=1.3)
right <- 0.8 * (par("usr")[2] - par("usr")[1]) + par("usr")[1]
text(right, -1.2, "Automated LW", font=2)
text(right, -1.6, "LC25", adj=1)
text(right, -1.6, paste(" =", formatC(LC25, digits=3, flag="#")), adj=0)
text(right, -2, "LC50", adj=1)
text(right, -2, paste(" =", formatC(LC50, digits=3, flag="#")), adj=0)
text(right, -2.4, "LC99.9", adj=1)
text(right, -2.4, paste(" =", formatC(LC99.9, digits=3, flag="#")), adj=0)
text(right, -2.8, "Slope", adj=1)
text(right, -2.8, paste(" =", formatC(slope, digits=3, flag="#")), adj=0)
if(!is.na(chi$p) & chi$p < 0.05) text(right, -3.2, "(poor fit)")
left <- 0.2 * (par("usr")[2] - par("usr")[1]) + par("usr")[1]
text(left, 2.9, "Probit", font=2, col="red")
text(left, 2.5, "LC25", adj=1, col="red")
text(left, 2.5, paste(" =", formatC(D25[1], digits=3, flag="#")), adj=0, col="red")
text(left, 2.1, "LC50", adj=1, col="red")
text(left, 2.1, paste(" =", formatC(D50[1], digits=3, flag="#")), adj=0, col="red")
text(left, 1.7, "LC99.9", adj=1, col="red")
text(left, 1.7, paste(" =", formatC(D999[1], digits=3, flag="#")), adj=0, col="red")
text(left, 1.3, "Slope", adj=1, col="red")
text(left, 1.3, paste(" =", formatC(Pslope[1], digits=3, flag="#")), adj=0, col="red")
rm(int, LC0.1, pred, cor.pred, tikz1, tikz3, tikz4, right)
}
dfout
}
rawfile <- tk_choose.files(filters=matrix(c("csv", ".csv"), ncol=2))
rawfile
rawdat <- read.csv(rawfile, as.is=TRUE)
rawdat2 <- data.frame(lapply(rawdat, fill))
filesegs <- strsplit(rawfile, "/")[[1]]
L <- length(filesegs)
filename <- filesegs[L]
dirname <- paste(filesegs[-L], collapse="/")
prefix <- strsplit(filename, ".csv")[[1]]
smryname <- paste0(prefix, "Smry.csv")
pdfname <- paste0(prefix, "Smry.pdf")
sut <- sort(unique(rawdat2$Test.ID))
results <- vector("list", length(sut))
sut
rawdat
i <- 1
i <- 1
sel <- rawdat2$Test.ID==sut[i]
dose=rawdat2$TFM.Conc...mg.L.[sel]
ndead=rawdat2$No..Dead[sel]
ntot=rawdat2$No..Tested[sel]
description=with(rawdat2[sel, ], paste(Test.ID, Source, Batch, Species))[1]
### A. The data and graph.
# A 1. Don't list > 2 consecutive 100% effects at the upper end or > 2 consecutive 0% effects at the lower end.
df <- data.frame(dose=dose, ndead=ndead, ntot=ntot)
df$nalive <- df$ntot - df$ndead
df$pdead <- df$ndead/df$ntot
df <- df[order(df$dose, df$pdead), ]
# get rid of any zero dosages (controls)
df <- df[df$dose > 0, ]
# get rid of consecutives ...
df2 <- df[only2consec(df$pdead), ]
# define three mortality categories, 0 for no dead, 100 for all dead, and 50 from any proportional mortality
df2$mcat <- rep(50, length(df2$pdead))
df2$mcat[df2$ntot==df2$nalive] <- 0
df2$mcat[df2$ntot==df2$ndead] <- 100
# if we have < 3 observations or we only have all dead or all survive, we can't estimate LCs
if((var(df2$mcat) < 0.00000001 & df2$mcat[1] != 50) | dim(df2)[1] < 3) {
estLCs <- NA
chi <- NA
} else {
# A 2. Plot doses against % effect on logarithmic-probability paper
df2$x <- log10(df2$dose)
df2$y <- probit(df2$pdead)
yr <- probit(c(0.001, 0.999))
df2$y[df2$pdead==0] <- yr[1]
df2$y[df2$pdead==1] <- yr[2]
# calculate starting values
pms <- sum(df2$mcat==50)
svp <- list(sv=c(NA, NA), p=NA)
# fit line to partial mortalities alone
if(pms > 1) {
df3 <- df2[df2$mcat==50, ]
svp <- startvals(df3)
}
# fit line to partial mortalities with last 0% and first 100%
if(pms==1 | is.na(svp$p)) {
df3 <- rbind(df2[df2$mcat==0, ][sum(df2$mcat==0), ], df2[df2$mcat==50, ], df2[df2$mcat==100, ][1, ])
svp <- startvals(df3)
}
# fit line to all the data
if(pms < 1 | is.na(svp$p)) {
svp <- startvals(df2)
}
# fit line to first 0% and last 100% alone
if(is.na(svp$p)) {
df3 <- rbind(df2[df2$mcat==0, ][1, ], df2[df2$mcat==100, ][sum(df2$mcat==100), ])
svp <- startvals(df3)
}
# find the LC50 and LC999 (on the log10 scale) that give the lowest p value for the chi-square
bestLC <- optim(par=svp$sv, fn=pchi.from.LC, data=df2)
estLCs <- bestLC$par
chi <- pchi.from.LC(estLCs, data=df2, list=T)
if(!is.na(chi$p) & chi$p < 0.05) print("Chi squared test indicates poor fit.")
rm(pms, svp, df3, bestLC)
}
# L-W
slope <- as.numeric(probit(0.999) / (estLCs[2] - estLCs[1]))
int <- -slope*estLCs[1]
LC25 <- as.numeric(10^( (probit(0.25) - int) / slope ))
LC50 <- as.numeric(10^estLCs[1])
LC99.9 <- as.numeric(10^estLCs[2])
slope
int
cleanup()
search()
source("C:\\JVA\\Lamprey\\ChemControl\\Toxicity\\LWPProgram.r")
source("C:\\JVA\\Lamprey\\ChemControl\\Toxicity\\LWPProgram.r")
ls()
sut
i <- 1
i <- 1
sel <- rawdat2$Test.ID==sut[i]
dose=rawdat2$TFM.Conc...mg.L.[sel]
ndead=rawdat2$No..Dead[sel]
ntot=rawdat2$No..Tested[sel]
description=with(rawdat2[sel, ], paste(Test.ID, Source, Batch, Species))[1]
### A. The data and graph.
# A 1. Don't list > 2 consecutive 100% effects at the upper end or > 2 consecutive 0% effects at the lower end.
df <- data.frame(dose=dose, ndead=ndead, ntot=ntot)
df$nalive <- df$ntot - df$ndead
df$pdead <- df$ndead/df$ntot
df <- df[order(df$dose, df$pdead), ]
# get rid of any zero dosages (controls)
df <- df[df$dose > 0, ]
# get rid of consecutives ...
df2 <- df[only2consec(df$pdead), ]
# define three mortality categories, 0 for no dead, 100 for all dead, and 50 from any proportional mortality
df2$mcat <- rep(50, length(df2$pdead))
df2$mcat[df2$ntot==df2$nalive] <- 0
df2$mcat[df2$ntot==df2$ndead] <- 100
# if we have < 3 observations or we only have all dead or all survive, we can't estimate LCs
if((var(df2$mcat) < 0.00000001 & df2$mcat[1] != 50) | dim(df2)[1] < 3) {
estLCs <- NA
chi <- NA
} else {
# A 2. Plot doses against % effect on logarithmic-probability paper
df2$x <- log10(df2$dose)
df2$y <- probit(df2$pdead)
yr <- probit(c(0.001, 0.999))
df2$y[df2$pdead==0] <- yr[1]
df2$y[df2$pdead==1] <- yr[2]
# calculate starting values
pms <- sum(df2$mcat==50)
svp <- list(sv=c(NA, NA), p=NA)
# fit line to partial mortalities alone
if(pms > 1) {
df3 <- df2[df2$mcat==50, ]
svp <- startvals(df3)
}
# fit line to partial mortalities with last 0% and first 100%
if(pms==1 | is.na(svp$p)) {
df3 <- rbind(df2[df2$mcat==0, ][sum(df2$mcat==0), ], df2[df2$mcat==50, ], df2[df2$mcat==100, ][1, ])
svp <- startvals(df3)
}
# fit line to all the data
if(pms < 1 | is.na(svp$p)) {
svp <- startvals(df2)
}
# fit line to first 0% and last 100% alone
if(is.na(svp$p)) {
df3 <- rbind(df2[df2$mcat==0, ][1, ], df2[df2$mcat==100, ][sum(df2$mcat==100), ])
svp <- startvals(df3)
}
# find the LC50 and LC999 (on the log10 scale) that give the lowest p value for the chi-square
bestLC <- optim(par=svp$sv, fn=pchi.from.LC, data=df2)
estLCs <- bestLC$par
chi <- pchi.from.LC(estLCs, data=df2, list=T)
if(!is.na(chi$p) & chi$p < 0.05) print("Chi squared test indicates poor fit.")
rm(pms, svp, df3, bestLC)
}
estLCs
source("C:\\JVA\\Lamprey\\ChemControl\\Toxicity\\LWPProgram.r")
source("C:\\JVA\\Lamprey\\ChemControl\\Toxicity\\LWPProgram.r")
source("C:\\JVA\\Lamprey\\ChemControl\\Toxicity\\LWPProgram.r")
source("C:\\JVA\\Lamprey\\ChemControl\\Toxicity\\LWPProgram.r")
source("C:\\JVA\\Lamprey\\ChemControl\\Toxicity\\LWPProgram.r")
cleanup()
q()
?cheat
# C:\JVA\Consult\Johnson J\Salmon habitat\Chesson.r
wb <- loadWorkbook("C:/JVA/Consult/Johnson J/Salmon habitat/Selectivity.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[1], startRow=2, endRow=8)
dat
wb <- loadWorkbook("C:/JVA/Consult/Johnson J/Salmon habitat/Selectivity.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[1], startRow=2, endCol=8)
dat
head(dat)
names(dat) <- c("stream", "type", "vel", "time", "rbt1", "av", "ratio", "alpha")
head(dat)
# C:\JVA\Consult\Johnson J\Salmon habitat\Chesson.r
wb <- loadWorkbook("C:/JVA/Consult/Johnson J/Salmon habitat/Selectivity.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[1], startRow=2, endCol=8)
names(dat) <- c("stream", "type", "vel", "time", "rbt1", "av", "ratio", "alpha")
head(dat)
dat2 <- dat[!is.na(dat$alpha), ]
fit <- aov(alpha ~ stream + type + time + type*time)
summary(fit)
fit <- aov(alpha ~ stream + type + time + type*time, data=dat2)
summary(fit)
dat2
dat2[order(dat2$alpha), ]
wb <- loadWorkbook("C:/JVA/Consult/Johnson J/Salmon habitat/Selectivity.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[1], startRow=2, endCol=8)
names(dat) <- c("stream", "type", "vel", "time", "rbt1", "av", "ratio", "alpha")
head(dat)
dat2 <- dat[!is.na(dat$alpha), ]
fit <- aov(alpha ~ stream + type + time + type*time, data=dat2)
summary(fit)
dat2$timen <- recode(time, c("Pre", "1Post", "9Post"), 1:3)
dat2$timen <- recode(dat2$time, c("Pre", "1Post", "9Post"), 1:3)
dat2
attach(dat2)
sus <- sort(unique(stream))
sut <- sort(unique(type))
windows()
plot(timen, alpha, type="n")
for(i in sus) {
for(j in sut) {
sel <- stream==sus[i] & type==sut[j]
lines(timen[sel], alpha[sel], col=i, pch=j, lwd=j, lty=j)
}}
i <- 1
j <- 1
sel <- stream==sus[i] & type==sut[j]
sel
sum(sel)
sus
stream
type
sut
plot(timen, alpha, type="n")
for(i in sus) {
for(j in sut) {
sel <- stream==sus[i] & type==sut[j]
if(sum(sel)>0) lines(timen[sel], alpha[sel], col=i, pch=j, lwd=j, lty=j)
}}
dat2
search()
detach()
dat2 <- dat[!is.na(dat$alpha), ]
fit <- aov(alpha ~ stream + type + time + type*time, data=dat2)
summary(fit)
dat2$timen <- recode(dat2$time, c("Pre", "1Post", "9Post"), 1:3)
dat2$str <- substring(dat2$stream, 1, 1)
attach(dat2)
sus <- sort(unique(str))
sut <- sort(unique(type))
windows()
plot(timen, alpha, type="n")
for(i in sus) {
for(j in sut) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) lines(timen[sel], alpha[sel], col=i, pch=j, lwd=j, lty=j)
}}
dat2
dat2 <- dat[!is.na(dat$alpha), ]
dat2$timen <- recode(dat2$time, c("Pre", "1Post", "9Post"), 1:3)
dat2$str <- substring(dat2$stream, 1, 1)
fit <- aov(alpha ~ str + type + time + type*time, data=dat2)
summary(fit)
sus <- sort(unique(str))
sut <- sort(unique(type))
sel <- str==sus[i] & type==sut[j]
sel
sus
sut
str
type
i
j
plot(timen, alpha, type="n")
for(i in seq(sus)) {
for(j in seq(sut)) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) lines(timen[sel], alpha[sel], col=i, pch=j, lwd=j, lty=j)
}}
dat2
points(timen[sel], alpha[sel], col=i, pch=j)
mnz <- tapply(alpha[sel], timen[sel], mean)
mnz
par(mar=c(4, 4, 1, 1), cex=1.5)
plot(timen, alpha, type="n")
for(i in seq(sus)) {
for(j in seq(sut)) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) {
text(timen[sel], alpha[sel], str[sel], col=i, font=2)
mnz <- tapply(alpha[sel], timen[sel], mean)
lines(names(mnz), mnz, col=i, lwd=j, lty=j)
}
}}
par(mar=c(4, 4, 1, 1), cex=1.5)
plot(timen, alpha, type="n")
for(i in seq(sus)) {
for(j in seq(sut)) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) {
text(timen[sel], alpha[sel], str[sel], col=j+1, font=2)
mnz <- tapply(alpha[sel], timen[sel], mean)
lines(names(mnz), mnz, col=j, lwd=j, lty=j)
}
}}
par(mar=c(4, 4, 1, 1), cex=1.5)
plot(timen, alpha, type="n")
for(i in seq(sus)) {
for(j in seq(sut)) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) {
text(timen[sel], alpha[sel], str[sel], col=j+2, font=2)
mnz <- tapply(alpha[sel], timen[sel], mean)
lines(names(mnz), mnz, col=j+2, lwd=j, lty=j)
}
}}
par(mar=c(4, 4, 1, 1), cex=1.5)
plot(timen, alpha, type="n", axes=FALSE, xlab="Time", ylab="Selectivity for high velocity")
axis(1, at=1:3, c("Pre", "Post 1 wk", "Post 9 wk"))
axis(2)
box()
for(i in seq(sus)) {
for(j in seq(sut)) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) {
text(timen[sel], alpha[sel], str[sel], col=j+2, font=2)
mnz <- tapply(alpha[sel], timen[sel], mean)
lines(names(mnz), mnz, col=j+2, lwd=j, lty=j)
}
}}
legend("bottomleft", sut, col=3:4, lwd=2, lty=1:2)
dat2
par(mar=c(4, 4, 1, 1), cex=1.5)
plot(timen, alpha, type="n", axes=FALSE, xlab="Time", ylab="Selectivity for high velocity")
axis(1, at=1:3, c("Pre", "Post 1", "Post 9"))
axis(2, las=1)
box()
for(i in seq(sus)) {
for(j in seq(sut)) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) {
text(timen[sel], alpha[sel], str[sel], col=j+2, font=2)
mnz <- tapply(alpha[sel], timen[sel], mean)
lines(names(mnz), mnz, col=j+2, lwd=2, lty=j)
}
}}
legend("bottomleft", sut, col=3:4, lwd=2, lty=1:2)
par(mar=c(4, 4, 1, 1), cex=1.5)
plot(timen, alpha, type="n", axes=FALSE, xlab="Time", ylab="Selectivity of rainbow trout for high velocity")
axis(1, at=1:3, c("Pre", "Post 1", "Post 9"))
axis(2, las=1)
box()
for(i in seq(sus)) {
for(j in seq(sut)) {
sel <- str==sus[i] & type==sut[j]
if(sum(sel)>0) {
text(timen[sel], alpha[sel], str[sel], col=j+2, font=2)
mnz <- tapply(alpha[sel], timen[sel], mean)
lines(names(mnz), mnz, col=j+2, lwd=2, lty=j)
}
}}
legend("bottomleft", sut, col=3:4, lwd=2, lty=1:2)
summary(fit)
cleanup()
q()
?addHeader
?rtf
addHeader
addHeader.RTF
rtf:::addHeader.RTF
.add.header
rtf:::.add.header
q()
install.packages("data.table")
install.packages("devtools")
install.packages("dplyr")
install.packages("fpc")
install.packages(c("ggvis", "GISTools", "googleVis", "knitr", "minqa", "quantmod", "splancs"))
search()
detach(7)
detach(6)
search()
detach(6)
install.packages("nlme")
install.packages("multcomp")
update.packages(ask='graphics',checkBuilt=TRUE)
search()
detach(6)
detach(6)
search()
update.packages(ask='graphics',checkBuilt=TRUE)
update.packages(ask='graphics',checkBuilt=TRUE)
q()
q()
Year <- 1990:2014
Control <- scan()
Assessment <- scan()
ls
ls
ls()
Control
plot(Year, Control/Assessment)
windows()
par(mar=c(4, 4, 1, 1))
plot(Year, Control/Assessment, pch=c(1, 16)[(Year>2005.5) + 1])
plot(Year, Control/Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1)
par(mar=c(4, 4, 2, 1))
plot(Year, Control/Assessment, pch=c(1, 16)[(Year>2005.5) + 1], main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment, 2)
)
lines(loess.smooth(Year, Control/Assessment, degree=2))
lines(loess.smooth(Year, Control/Assessment, degree=1))
par(mar=c(4, 4, 2, 1))
plot(Year, Control/Assessment, pch=c(1, 16)[(Year>2005.5) + 1], main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment))
lines(loess.smooth(Year, Control/Assessment))legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs")
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs")
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1), cex=1.2)
plot(Year, Control/Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment))
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs")
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1), cex=1)
plot(Year, Control/Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment))
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs")
par(mar=c(4, 4, 2, 1), cex=1)
plot(Year, Control / Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment), lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs", bty="n")
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1))
plot(Year, Control / Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment), lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs", bty="n")
par(mar=c(4, 4, 2, 1))
plot(Year, Control / Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, pt.cex=1.2, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment), lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs", bty="n")
par(mar=c(4, 4, 2, 1))
plot(Year, Control / Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, cex=1.2, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment), lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), title="Administrative costs", bty="n")
par(mar=c(4, 4, 2, 1))
plot(Year, Control / Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, cex=1.2, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment), lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), cex=1.2, title="Administrative costs", bty="n")
par(mar=c(4, 4, 2, 1))
plot(Year, Control / Assessment, pch=c(1, 16)[(Year>2005.5) + 1], las=1, cex=1.2, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment), lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(1, 16), pt.cex=1.2, title="Administrative costs", bty="n")
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1))
plot(Year, Control / Assessment, pch=c(3, 16)[(Year>2005.5) + 1], las=1, cex=1.2, main="Ratio of Control to Assessment Budget")
lines(loess.smooth(Year, Control/Assessment), lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(3, 16), pt.cex=1.2, title="Administrative costs", bty="n")
fit <- lm(Control/Assessment ~ Year>2007.5)
fit
fit <- lm(Control/Assessment ~ I(Year>2007.5))
fit
fit <- lm(Control/Assessment ~ I(Year>2007.5) - 1)
fit
fit <- lm(Control/Assessment ~ I(Year>2007.5) - 1)
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1))
plot(Year, Control/Assessment, pch=c(3, 16)[(Year>2005.5) + 1], las=1, cex=1.2, ylab="Control / Assessment", main="Ratio of Control to Assessment Budget")
sel <- Year>2007.5
lines(Year[sel], (Control/Assessment), [sel], lwd=2)
lines(Year[!sel], (Control/Assessment), [!sel], lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(3, 16), pt.cex=1.2, title="Administrative costs", bty="n")
fit <- lm(Control/Assessment ~ I(Year>2007.5) - 1)
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1))
plot(Year, Control/Assessment, pch=c(3, 16)[(Year>2005.5) + 1], las=1, cex=1.2, ylab="Control / Assessment", main="Ratio of Control to Assessment Budget")
sel <- Year>2007.5
lines(Year[sel], (Control/Assessment)[sel], lwd=2)
lines(Year[!sel], (Control/Assessment)[!sel], lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(3, 16), pt.cex=1.2, title="Administrative costs", bty="n")
fit <- lm(Control/Assessment ~ I(Year>2007.5) - 1)
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1))
plot(Year, Control/Assessment, pch=c(3, 16)[(Year>2005.5) + 1], las=1, cex=1.2, ylab="Control / Assessment", main="Ratio of Control to Assessment Budget")
sel <- Year>2007.5
lines(Year[sel], fit$fitted[sel], lwd=2)
lines(Year[!sel], fit$fitted[!sel], lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(3, 16), pt.cex=1.2, title="Administrative costs", bty="n")
fit
Assessment
sort(Assessment)
fit <- lm(Control/Assessment ~ I(Year>2007.5) - 1)
windows(h=5, w=5)
par(mar=c(4, 4, 2, 1))
plot(Year, Control/Assessment, pch=c(3, 16)[(Year>2005.5) + 1], las=1, cex=1.2, ylab="L. Control / Assessment", main="Ratio of L. Control to Assessment Budget")
sel <- Year>2007.5
lines(Year[sel], fit$fitted[sel], lwd=2)
lines(Year[!sel], fit$fitted[!sel], lwd=2)
legend("topleft", c("Included", "Excluded"), pch=c(3, 16), pt.cex=1.2, title="Administrative costs", bty="n")
cleanup()
q()
# C:\JVA\Lamprey\StMarys\AssPlan\TSPlots14.r - plot time series of St. Marys River Assessment Plan data
graph.ppt <- function(w=10, h=6) {
windows(canvas="black", w=w, h=h)
#palette(c("lightblue", "yellow", "green", "white", "pink", "orange"))
# color-blind friendly colors
# 1 black, 2 orange, 3 sky blue, 4 bluish green, 5 yellow, 6 blue, 7 vermillion, 8 reddish purple, 9 white
palette(blindcolz[c(3, 2, 5, 9, 4, 7, 8)])
par(col.axis=1, col.lab=1, col.main=1, col.sub=1, fg=1, cex=1.5)
}
#14########################## plot larva sea lamprey population estimates ###############################
whole.river <- read.csv("C:\\JVA\\Lamprey\\StMarys\\Larval Sampling\\WholeRiverEsts.csv", as.is=T, skip=2)
names(whole.river) <- casefold(names(whole.river))
# add in 1993-1996 data
add.old <- rbind(c(1994.5, 0, 5.2e6, NA, NA), whole.river[, c("year", "period", "pe", "lo", "hi")])
add.old[, 3:5] <- add.old[, 3:5]/1000000
add.old$type <- c(1, recode(whole.river$type, c("whole", "upper", "none", "treated", "region 5"), c(1, 1, 0, 0, 0)))
add.real <- add.old[add.old$type==1, ]
attach(add.real)
maxyr <- max(year)
adj <- 0.2
yrlab <- c("93-96", "99", substring(as.character(2000:maxyr), 3, 4))
pre <- year + adj*period < 1999
meanz <- apply(tapply(pe, list(year, pre==FALSE), mean), 2, mean, na.rm=T)
delta <- (meanz[2] - meanz[1])/meanz[1]
# black & white
palette("default")
windows(h=8, w=6.5)
par(las=1, mar=c(5, 5, 1, 1), yaxs="i")
plot((year + adj*period), pe, xlim=c(1994, maxyr+0.4), ylim=c(0, max(hi, na.rm=T))*1.02, axes=F, 
xlab="Year", ylab="PE  (millions)")
lines((year + adj*period), pe, lwd=3, col="gray")
arrows((year + adj*period), lo, (year + adj*period), hi, angle=90, code=3, length=0.1)
points((year + adj*period), pe, pch=16, cex=1.5)
axis(1, at=unique(year), label=yrlab)
axis(2)
box()
#abline(v=c(1998:1999, 2001, 2003:2014), lty=3, lwd=0.5)
# color
graph.ppt(9, 6)
par(las=1, mar=c(5, 5, 1, 1), yaxs="i")
plot(year + adj*period, pe, type="n", xlim=c(1994, maxyr+0.4), ylim=c(0, max(hi, na.rm=T))*1.02, axes=F, 
xlab="Year", ylab="Larva population  (millions)")
arrows((year + adj*period), lo, (year + adj*period), hi, angle=90, code=3, length=0.1)
for(i in 1:2) {
sel <- pre == c(T, F)[i]
points((year + adj*period)[sel], pe[sel], pch=16, col=c("cyan", "yellow")[i], cex=2)
}
axis(1, at=unique(year), label=yrlab)
axis(2)
box()
graph.ppt(9, 6)
par(las=1, mar=c(5, 5, 1, 1), yaxs="i")
plot(1, 1, type="n", axes=F, xlim=c(1994, maxyr+0.4), ylim=c(0, max(hi, na.rm=T))*1.02, xlab="", ylab="")
abline(v=c(1998:1999, 2001, 2003:2014))
t.test(pe[pre], pe[!pre], alter="great", var.equal=T)
round(100*delta)
dat.larv <- list(add.real=add.real, maxyr=maxyr, adj=adj, yrlab=yrlab, pre=pre, delta=delta)
detach(add.real)
rm(whole.river, add.old, add.real, maxyr, adj, yrlab, pre, meanz, delta, sel, i)
#14########################## plot adult numbers ###########################
spawn <- read.csv("C:\\JVA\\Lamprey\\Adults\\SpawnDisModel\\2014\\LakePEdynamic.csv", as.is=T)
hspawn <- spawn[spawn$lake==3 & spawn$year>1987.5, ]
attach(hspawn)
pre <- year < 2000.5
delta <- (mean(PE[!pre])-mean(PE[pre]))/mean(PE[pre])
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1))
plot(year, PE/1000, type="n", xlab="Year", ylab="")
par(mgp=c(4, 1, 0))
title(ylab="Population estimate  (thousands)")
abline(v=2000.5, lty=2, lwd=2)
for(i in 1:2) {
sel <- pre == c(T, F)[i]
points(year[sel], (PE/1000)[sel], lwd=3, type="b", pch=16, col=c("cyan", "yellow")[i])
lines(range(year[sel]), rep(mean((PE/1000)[sel]), 2), lwd=5, col=c("cyan", "yellow")[i])
}
t.test(PE[pre], PE[!pre], alter="great", var.equal=T)
round(100*delta)
dat.adul <- list(hspawn=hspawn, pre=pre, delta=delta)
detach(hspawn)
rm(spawn, hspawn, pre, delta, i, sel)
#14########################## plot metamorphosing fyke net CPEs ###########################
fyke <- read.csv("c:\\jva\\Lamprey\\StMarys\\AssPlan\\fyke.csv", as.is=T)
attach(fyke)
pre <- year < 1998.5
delta <- (mean(cpe[!pre])-mean(cpe[pre]))/mean(cpe[pre])
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1))
plot(year, cpe, type="n", xlab="Year", ylab="Catch per fyke net day")
abline(v=1998.5, lty=2, lwd=2)
for(i in 1:2) {
sel <- pre == c(TRUE, FALSE)[i]
points(year[sel], cpe[sel], lwd=3, type="b", pch=16, col=c("cyan", "yellow")[i])
lines(range(year[sel]), rep(mean(cpe[sel]), 2), lwd=5, col=c("cyan", "yellow")[i])
}
t.test(cpe[pre], cpe[!pre], alter="great", var.equal=T)
round(100*delta)
dat.meta <- list(fyke=fyke, pre=pre, delta=delta)
detach(fyke)
rm(fyke, pre, delta, i, sel)
#14########################## plot commercial bycatch of juveniles ###########################
bycatch <- read.csv("C:\\JVA\\Lamprey\\StMarys\\AssPlan\\parasitics.csv", as.is=T, skip=5)
names(bycatch) <- casefold(names(bycatch))
# calculate cpe in number per km of net per night
bycatch$cpe <- 1093.61*bycatch$catch/bycatch$effort..gillnet.yards.
plotby <- bycatch[bycatch$year>1986.5, ]
attach(plotby)
pre <- year<1999.5
# old metric, unadjusted for effort
if(FALSE) {
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1))
plot(year, catch/1000, type="n", xlab="Year", ylab="Relative abundance  (thousands)")
abline(v=1999.5, lty=2, lwd=2)
for(i in 1:2) {
sel <- (year < 1999.5) == c(TRUE, FALSE)[i]
points(year[sel], catch[sel]/1000, lwd=3, type="b", pch=16, col=c("cyan", "yellow")[i])
lines(range(year[sel]), rep(mean(catch[sel]), 2)/1000, lwd=5, col=c("cyan", "yellow")[i])
}
t.test(catch[pre], catch[!pre], alter="great", var.equal=T)
}
# new metric, adjusted for effort (new for 2014-02 SLCB)
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1))
plot(year, cpe, type="n", xlab="Year", ylab="CPE  (No. per km gillnet per night)")
abline(v=1999.5, lty=2, lwd=2)
for(i in 1:2) {
sel <- (year < 1999.5) == c(TRUE, FALSE)[i]
points(year[sel], cpe[sel], lwd=3, type="b", pch=16, col=c("cyan", "yellow")[i])
lines(range(year[sel]), rep(mean(cpe[sel], na.rm=TRUE), 2), lwd=5, col=c("cyan", "yellow")[i])
}
t.test(cpe[pre], cpe[!pre], alter="great", var.equal=T)
dat.juve <- list(plotby=plotby, pre=pre)
detach(plotby)
rm(bycatch, plotby, pre, i, sel)
#14########################## plot wounding rates ###########################
wound <- read.csv("C:\\JVA\\Lamprey\\StMarys\\AssPlan\\wounds2014.csv", as.is=T, skip=1)
wound$fyear <- wound$year - 1
attach(wound)
pre <- fyear < 1999.5
cols <- c("yellow", "cyan", "magenta")
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1), yaxs="i")
plot(fyear, theta, type="n", ylim=1.05*c(0, max(theta)), xlab="Year", ylab="Asymptotic wounding rate")
for(i in 3:1) points(fyear[region==i], theta[region==i], lwd=3, type="b", pch=c(78, 67, 83)[i], col=cols[i])
legend(1986, 1, c("North", "Central", "South"), lwd=3, bty="n", col=cols, text.col=cols)
abline(v=1999.5, lty=2, lwd=2)
for(i in 1:3) print(t.test(theta[region==i & pre], theta[region==i & !pre], alter="great", var.equal=T))
delta <- rep(NA, 3)
for(j in 1:3) delta[j] <- (mean(theta[!pre & region==j])-mean(theta[pre & region==j]))/mean(theta[pre & region==j])
round(100*delta)
dat.woun <- list(wound=wound, pre=pre, delta=delta)
detach(wound)
rm(wound, pre, cols, i, j)
#14########################## plot lake trout CPE ###########################
trout <- read.csv("C:\\JVA\\Lamprey\\StMarys\\AssPlan\\LTCPE14.csv", as.is=T, skip=3)
names(trout) <- casefold(names(trout))
trout.p <- trout[trout$year>1990.5, ]
attach(trout.p)
pre <- year < 2000.5
# all four combinations
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1))
plot(0, 0, type="n", xlim=range(year), ylim=range(trout.p[, 2:5], na.rm=T), cex=1.3, lwd=1, xlab="Year", ylab="Relative return rate  (CPE/#stocked)")
lines(year, age5mh2, lty=2, pch=16, type="o", lwd=1, col="cyan")
lines(year, age6mh2, lty=1, pch=16, type="o", lwd=3, col="cyan")
lines(year, age5mh1, lty=2, pch=16, type="o", lwd=1, col="yellow")
lines(year, age6mh1, lty=1, pch=16, type="o", lwd=3, col="yellow")
#legend(1990.5, 34, lty=c(2, 1, 2, 1), lwd=c(1, 3, 1, 3), col=c("yellow", "yellow", "cyan", "cyan"), bty="n", cex=0.8, 
legend("topleft", lty=c(2, 1, 2, 1), lwd=c(1, 3, 1, 3), col=c("yellow", "yellow", "cyan", "cyan"), bty="n", cex=0.8, 
    legend=c("MH-1  age 5", "MH-1  age 6", "MH-2  age 5", "MH-2  age 6"))
abline(v=2000.5, lty=2, lwd=3)
apply(trout.p[, 2:5], 2, function(x) t.test(x[pre], x[!pre], alter="less"))
dat.lktr <- list(trout.p=trout.p, pre=pre)
detach(trout.p)
rm(trout.p, pre)
#14########################## plot lake trout mortality ###########################
attach(trout)
pre <- year < 1999.5
delta <- c(
(mean(mort56mh1[!pre], na.rm=T)-mean(mort56mh1[pre], na.rm=T))/mean(mort56mh1[pre], na.rm=T), 
(mean(mort56mh2[!pre], na.rm=T)-mean(mort56mh2[pre], na.rm=T))/mean(mort56mh2[pre], na.rm=T)
)
# plot each region separately
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1))
plot(0, 0, type="n", xlim=range(year), ylim=0:1, axes=F, xlab="Year", ylab="Annual cohort mortality, age 5 to 6")
abline(v=1999.5, lty=2, lwd=3)
for(i in 1:2) {
sel <- pre == c(T, F)[i]
points(year[sel], mort56mh1[sel], lwd=3, type="b", col=c("cyan", "yellow")[i], pch=16)
lines(range(year[sel]), rep(mean(mort56mh1[sel], na.rm=T), 2), lwd=5, col=c("cyan", "yellow")[i])
}
axis(1, at=seq(1980, 2010, 5))
axis(2)
box()
graph.ppt()
par(las=1, mar=c(5, 5, 1, 1))
plot(0, 0, type="n", xlim=range(year), ylim=0:1, axes=F, xlab="Year", ylab="Annual cohort mortality, age 5 to 6")
abline(v=1999.5, lty=2, lwd=3)
for(i in 1:2) {
sel <- pre == c(T, F)[i]
points(year[sel], mort56mh2[sel], lwd=3, type="b", col=c("cyan", "yellow")[i], pch=16)
lines(range(year[sel]), rep(mean(mort56mh2[sel], na.rm=T), 2), lwd=5, col=c("cyan", "yellow")[i])
}
axis(1, at=seq(1980, 2010, 5))
axis(2)
box()
apply(trout[, 6:7], 2, function(x) t.test(x[pre & !is.na(x)], x[!pre & !is.na(x)], alter="great"))
round(100*delta)
dat.ltmo <- list(trout=trout, pre=pre, delta=delta)
detach(trout)
rm(trout, pre, delta, i, sel)
#########################################################################################
############################# PLOT SUMMARY SLIDE #####(use MH1)##########################
#########################################################################################
cex.all <- 0.5
palette("default")
windows(h=7.25, w=6.5)
#par(mfcol=c(4, 2), oma=c(0, 0, 2.5, 0), mar=c(5, 5, 3, 1), yaxs="i", las=1)
par(mfcol=c(4, 2), mar=c(5, 5, 2, 1), yaxs="i", las=1, cex=cex.all)
### larva
attach(dat.larv)
attach(add.real)
plot(year + adj*period, pe, pch=16, xlim=range(year) + c(-1, 1)/10, ylim=1.1*c(0, max(pe, na.rm=T)), 
axes=F, xlab="Year", ylab="PE  (millions)", main=paste("SMR SL Larva:  ", round(100*delta), "%", sep=""), cex=1.5)
axis(1, at=unique(year), label=yrlab, cex=1.1)
axis(2, cex=1.1)
box()
abline(v=1999, lty=2)
for(i in 1:2) {
sel <- (year + adj*period < 1999) == c(TRUE, FALSE)[i]
lines(range(year[sel]), rep(mean(pe[sel]), 2), lwd=2)
}
detach(add.real)
detach(dat.larv)
### metamorphosing
attach(dat.meta)
attach(fyke)
plot(year, cpe, pch=16, xlab="Year", ylab="Catch / fyke day", xlim=range(year) + c(-1, 1)/10, ylim=1.1*c(0, max(cpe)),
main=paste("SMR SL Metamorphosing:  ", round(100*delta), "%", sep=""), cex=1.5)
abline(v=1998.5, lty=2)
for(i in 1:2) {
sel <- (year < 1998.5) == c(TRUE, FALSE)[i]
lines(range(year[sel]), rep(mean(cpe[sel]), 2), lwd=2)
}
detach(fyke)
detach(dat.meta)
rm(i, sel)
### bycatch of juveniles
attach(dat.juve)
attach(plotby)
# old metric
if(FALSE) {
plot(year, catch/1000, pch=16, cex=1.5, ylim=1.1*c(0, max(catch/1000)), 
xlab="Year", ylab="Rel. abundance  (thousands)",main="NCLH SL Juvenile:  no decline")
abline(v=1999.5, lty=2)
for(i in 1:2) {
sel <- (year < 1999.5) == c(TRUE, FALSE)[i]
lines(range(year[sel]), rep(mean(catch[sel]), 2)/1000, lwd=2)
}
}
# new metric
plot(year, cpe, pch=16, cex=1.5, ylim=1.1*c(0, max(cpe, na.rm=TRUE)), 
xlab="Year", ylab="CPE  (No. per km gillnet per night)",main="NCLH SL Juvenile:  no decline")
abline(v=1999.5, lty=2)
for(i in 1:2) {
sel <- (year < 1999.5) == c(TRUE, FALSE)[i]
lines(range(year[sel]), rep(mean(cpe[sel], na.rm=TRUE), 2), lwd=2)
}
detach(plotby)
detach(dat.juve)
rm(i, sel)
### adults
attach(dat.adul)
attach(hspawn)
plot(year, PE/1000000, xlim=range(year) + c(-1, 1)/10, ylim=1.1*c(0, max(PE/1000000)), pch=16, cex=1.5, 
xlab="Year", ylab="PE  (millions)", main=paste("LH SL Adult:  ", round(100*delta), "%", sep=""))
abline(v=2000.5, lty=2)
for(i in 1:2) {
sel <- pre == c(TRUE, FALSE)[i]
lines(range(year[sel]), rep(mean((PE/1000000)[sel]), 2), lwd=2)
}
detach(hspawn)
detach(dat.adul)
rm(i, sel)
### summary numbers
#par(mar=c(0, 0, 3, 0), cex=0.8)
par(mar=c(0, 0, 3, 0))
plot(0:1, 0:1, type="n", axes=F, xlab="", ylab="")
mtext("Summary", side=3, line=-2, font=2, cex=1.1)
text(c(0.1, 0.6), c(0.75, 0.75), c("Sea Lampreys", "Lake Trout"), cex=1.5, adj=0)
text(0.1, 0.6, paste("Larva PE:  ", round(100*dat.larv$delta), "%", sep=""), adj=0, cex=1.1)
text(0.1, 0.5, paste("Metamorphosing CPE:  ", round(100*dat.meta$delta), "%", sep=""), adj=0, cex=1.1)
text(0.1, 0.4, "Juvenile Bycatch:  no decline", adj=0, cex=1.1)
text(0.1, 0.3, paste("Adult PE:  ", round(100*dat.adul$delta), "%", sep=""), adj=0, cex=1.1)
text(0.6, 0.6, paste("Wounding Rate:  ", round(100*dat.woun$delta[1]), "%", sep=""), adj=0, cex=1.1)
text(0.6, 0.5, "Return Rate:  no increase", adj=0, cex=1.1)
text(0.6, 0.4, paste("Mortality:  ", round(100*dat.ltmo$delta[1]), "%", sep=""), adj=0, cex=1.1)
par(mar=c(5, 5, 2, 1))
#mtext("St. Marys River Assessment Plan - 2014 Update", side=3, outer=T, cex=1.5, line=0.5)
#par(cex=0.66)
### wounds
attach(dat.woun)
attach(wound)
plot(fyear[region==1], theta[region==1], pch=16, xlim=range(fyear) + c(-1, 1)/10, ylim=1.05*c(0, max(theta[region==1])), 
xlab="Year", ylab="Asymptotic rate", main=paste("MH1 SL-LT Wounding Rate:  ", round(100*delta[1]), "%", sep=""), cex=1.5)
abline(v=1999.5, lty=2)
for(i in 1:2) {
sel <- pre == c(TRUE, FALSE)[i] & region==1
lines(range(fyear[sel]), rep(mean(theta[sel]), 2), lwd=2)
}
detach(wound)
detach(dat.woun)
rm(i, sel)
### lake trout return rate - age 5 MH1
attach(dat.lktr)
attach(trout.p)
plot(year, age5mh1, pch=16, xlim=range(year) + c(-1, 1)/10, ylim=1.1*c(0, max(age5mh1, na.rm=T)), 
cex=1.5, xlab="Year", ylab="Return rate", main="MH1 Age 5 LT Return Rate:  no increase")
abline(v=2000.5, lty=2)
for(i in 1:2) {
sel <- pre == c(TRUE, FALSE)[i]
lines(range(year[sel]), rep(mean(age5mh1[sel], na.rm=T), 2), lwd=2)
}
detach(trout.p)
detach(dat.lktr)
rm(i, sel)
### lake trout mortality
attach(dat.ltmo)
attach(trout)
plot(year, mort56mh1, pch=16, xlim=range(year) + c(-1, 1)/10, ylim=0:1, cex=1.5, 
xlab="Year", ylab="Mortality, age 5 to 6", main=paste("MH1 LT Mortality:  ", round(100*delta[1]), "%", sep=""))
abline(v=1999.5, lty=2)
for(i in 1:2) {
sel <- pre == c(T, F)[i]
lines(range(year[sel]), rep(mean(mort56mh1[sel], na.rm=T), 2), lwd=2)
}
detach(trout)
detach(dat.ltmo)
rm(i, sel)
graphics.off()
q()
cleanup()
ls()
?cheat
# read in xls files
library(XLConnect)
wb <- loadWorkbook("C:/JVA/Consult/Deines/master_harvest_chl_metadata.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[1], startRow=1)
head(dat)
# read in xls files
library(XLConnect)
wb <- loadWorkbook("C:/JVA/Consult/Deines/master_harvest_chl_metadata.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[2], startRow=1)
warnings()
# C:\JVA\Consult\Deines\ExploreChla.r
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.xlsx")
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.csv")
dim(dat)
head(dat)
plotdf(dat)
lapply(dat, class)
head(dat)
as.Date(dat$BEG_DATE[1:10])
?as.Date
as.Date(dat$BEG_DATE[1:10], "%d-%b-%y")
# visualize time spans
dat$BEG_DATE <- as.Date(dat$BEG_DATE, "%d-%b-%y")
dat$END_DATE <- as.Date(dat$END_DATE, "%d-%b-%y")
dat$duration <- dat$END_DATE - dat$BEG_DATE
format(dat$BEG_DATE[1:10], "%j")
as.numeric(format(dat$BEG_DATE[1:10], "%j"))
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
with(dat, plot(jday, duration))
with(dat, hist(duration))
dat$duration <- as.numeric(dat$END_DATE - dat$BEG_DATE)
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
with(dat, plot(jday, duration))
with(dat, hist(duration))
plot(sort(dat$duration))
table(dat$duration)
rev(sort(table(dat$duration)))
with(dat, hist(duration, nclass=25))
stemleaf(dat$duration))
stemleaf(dat$duration)
??leaf
stem(dat$duration)
table(dat$duration)
cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("other", "month", "year")[c(1, 2, 1, 3, 1)])
cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("< 1", "1", "2-11", "12", ">12"))
head(dat)
dat$BEG_DATE[1:10]
month(dat$BEG_DATE[1:10])
??month
library(lubridate)
month(dat$BEG_DATE[1:10])
(dat$BEG_DATE + dat$END_DATE)/2
(dat$BEG_DATE + 5)
a <- table(Species.Code, Common.Name)
table(tapply(a, 1, sum))
table(tapply(a, 2, sum))
attach(dat)
a <- table(Species.Code, Common.Name)
table(tapply(a, 1, sum))
table(tapply(a, 2, sum))
a <- table(Species.Code, Common.Name)
table(apply(a, 1, sum))
table(apply(a, 2, sum))
a <- table(Species.Code, Common.Name)
a[apply(a, 1, sum)>1, ]
a <- table(Species.Code, Common.Name)
a[apply(a, 1, sum)>1, apply(a, 2, sum)>0]
a <- table(Species.Code, Common.Name)
b <- a[apply(a, 1, sum)>1, ]
b[, apply(b, 2, sum)>0]
dim(a)
dim(b)
a <- table(Species.Code, Common.Name)
b <- a[apply(a>0, 1, sum)>1, ]
dim(b)
a <- table(Species.Code, Common.Name)
b <- a[apply(a>0, 1, sum)>1, ]
dim(b)
b <- a[, apply(a>0, 2, sum)>1]
dim(b)
table(apply(a>0, 1, sum))
a <- table(Species.Code, Common.Name)
table(apply(a>0, 1, sum))
table(apply(a>0, 2, sum))
a[, apply(a>0, 2, sum)>1]
a[1:10, apply(a>0, 2, sum)>1]
dim(a)
apply(a>0, 2, sum)>1
dat[dat$Species.Code==0, ]
dat[dat$Species.Code=="0", ]
sort(unique(Species.Code))
dat[dat$Common.Name=="0", ]
a <- table(Common.Name, Trophic.Level)
table(apply(a>0, 1, sum))
table(apply(a>0, 2, sum))
tapply(Trophic.Level, Common.Name, var)
tapply(Trophic.Level, Common.Name, var, na.rm=TRUE)
tapply(Trophic.Level, Common.Name, sd, na.rm=TRUE)
sd
sort(tapply(Trophic.Level, Common.Name, sd, na.rm=TRUE))
rev(sort(tapply(Trophic.Level, Common.Name, sd, na.rm=TRUE)))
barplot(KG.Region)
barplot(table(KG.Region))
barplot(table(durationclass), las=1)
search()
detach()
library(lubridate)
# read in the data
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.csv")
# make sure trophic level is interpreted as numbers (not characters)
dat$Trophic.Level <- as.numeric(dat$Trophic.Level)
# time span calculations
dat$BEG_DATE <- as.Date(dat$BEG_DATE, "%d-%b-%y")
dat$END_DATE <- as.Date(dat$END_DATE, "%d-%b-%y")
dat$duration <- as.numeric(dat$END_DATE - dat$BEG_DATE)
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
dat$durationclass <- cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("< 1", "1", "2-11", "12", ">12"))
dat$month <- ifelse(dat$durationclass="1", month(dat$BEG_DATE + dat$duration/2), NA)
attach(dat)
barplot(table(KG.Region), las=1)
barplot(table(durationclass), las=1)
barplot(table(FisheryType), las=1)
barplot(table(FisheryDesc), las=1)
search()
detach()
library(lubridate)
# read in the data
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.csv")
# make sure trophic level is interpreted as numbers (not characters)
dat$Trophic.Level <- as.numeric(dat$Trophic.Level)
# time span calculations
dat$BEG_DATE <- as.Date(dat$BEG_DATE, "%d-%b-%y")
dat$END_DATE <- as.Date(dat$END_DATE, "%d-%b-%y")
dat$duration <- as.numeric(dat$END_DATE - dat$BEG_DATE)
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
dat$durationclass <- cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("< 1", "1", "2-11", "12", ">12"))
dat$month <- ifelse(dat$durationclass=="1", month(dat$BEG_DATE + dat$duration/2), NA)
attach(dat)
barplot(table(KG.Region), las=1)
barplot(table(durationclass), las=1)
barplot(table(FisheryType), las=1)
barplot(table(FisheryDesc), las=1)
graphics.off()
windows()
barplot(table(KG.Region), las=1, main="KG.Region")
windows()
barplot(table(durationclass), las=1, main="durationclass")
windows()
barplot(table(FisheryType), las=1, main="FisheryType")
windows()
barplot(table(FisheryDesc), las=1, main="FisheryDesc")
windows()
plot(Trophic.Level, best.chla.u, pch=Common.Name, col=Common.Name)
plot(Trophic.Level, best.chla.u, pch=Common.Name, col=as.factor(Common.Name))
plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
windows()
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name))
head(dat)
windows()
plot(best.chla.u, FISH_PROD_KG, log="xy", pch=Common.Name, col=as.factor(Common.Name))
?startrtf
dim(dat)
detach(dat)
detach(dat)
attach(dat)
doc <- startrtf("C:/JVA/Consult/Deines/Explore.doc")
para("Explore Whitney and Andy's species-specific global inland fisheries data")
fig <- barplot(table(KG.Region), las=1, main="KG.Region")
figu("Number of records (out of ", dim(dat)[1], ") in each ecoregion.")
windows()
barplot(table(durationclass), las=1, main="durationclass")
windows()
barplot(table(FisheryType), las=1, main="FisheryType")
windows()
barplot(table(FisheryDesc), las=1, main="FisheryDesc")
windows()
plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
windows()
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name))
endrtf()
doc <- startrtf("C:/JVA/Consult/Deines/Explore.doc")
para("Explore Whitney and Andy's species-specific global inland fisheries data")
fig <- function() barplot(table(KG.Region), las=1, main="KG.Region")
figu("Number of records (out of ", dim(dat)[1], ") in each ecoregion.")
windows()
barplot(table(durationclass), las=1, main="durationclass")
windows()
barplot(table(FisheryType), las=1, main="FisheryType")
windows()
barplot(table(FisheryDesc), las=1, main="FisheryDesc")
windows()
plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
windows()
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name))
endrtf()
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
para("Explore Whitney and Andy's species-specific global inland fisheries data")
fig <- function() barplot(table(KG.Region), las=1, main="KG.Region")
figu("Number of records (out of ", dim(dat)[1], ") in each ecoregion.")
windows()
barplot(table(durationclass), las=1, main="durationclass")
windows()
barplot(table(FisheryType), las=1, main="FisheryType")
windows()
barplot(table(FisheryDesc), las=1, main="FisheryDesc")
windows()
plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
windows()
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name))
endrtf()
date
date()
plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
fig <- function() barplot(table(KG.Region), las=1, main="KG.Region")
figu("Number of records (out of ", dim(dat)[1], ") in each ecoregion.", h=4, w=4)
fig <- function() barplot(table(durationclass), las=1, main="durationclass")
figu("Number of records (out of ", dim(dat)[1], ") in each duration class (number of months).", h=4, w=4)
fig <- function() barplot(table(FisheryType), las=1, main="FisheryType")
figu("Number of records (out of ", dim(dat)[1], ") in each fishery type.", h=4, w=4)
fig <- function() barplot(table(FisheryDesc), las=1, main="FisheryDesc")
figu("Number of records (out of ", dim(dat)[1], ") in each fishery description.", h=4, w=4)
fig <- function() plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name))
figu("Relation between chlorophyll a and fish biomass density by species.")
fig <- function() plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
figu("Relation between chlorophyll a and fish biomass density by species.")
endrtf()
table(durationclass, FisheryType)
plot(table(durationclass, FisheryType))
graphics.off()
plot(table(durationclass, FisheryType))
barplot(table(durationclass), las=1
)
barplot(table(durationclass, FisheryType))
barplot(table(FisheryType, durationclass))
barplot(table(FisheryType, durationclass), col=1:10)
??brew
rain
rainn
??color
barplot(table(FisheryType, durationclass), col=brewer.pal(10))
barplot(table(FisheryType, durationclass), col=brewer.pal(10, "YlGnBu"))
barplot(table(FisheryType, durationclass), col=brewer.pal(9, "YlGnBu"))
barplot(table(FisheryType, durationclass), col=brewer.pal(9, "YlGnBu"), las=1, main="FisheryType and durationclass")
legend(sort(unqiue(FisheryType)), fill=brewer.pal(9, "YlGnBu"))
barplot(table(FisheryType, durationclass), col=brewer.pal(9, "YlGnBu"), las=1, main="FisheryType and durationclass")
legend("topleft", sort(unqiue(FisheryType)), fill=brewer.pal(9, "YlGnBu"))
barplot(table(FisheryType, durationclass), col=brewer.pal(9, "YlGnBu"), las=1, main="FisheryType and durationclass")
legend("topleft", sort(unique(FisheryType)), fill=brewer.pal(9, "YlGnBu"))
lft <- length(unique(FisheryType))
barplot(table(FisheryType, durationclass), col=brewer.pal(lft, "YlGnBu"), las=1, main="FisheryType and durationclass")
legend("topleft", sort(unique(FisheryType)), fill=brewer.pal(lft, "YlGnBu"))
display.brewer.all() 
barplot(table(FisheryType, durationclass), col=brewer.pal(lft, "Dark2"), las=1, main="FisheryType and durationclass")
legend("topleft", sort(unique(FisheryType)), fill=brewer.pal(lft, "Dark2"))
display.brewer.all() 
suft <- sort(unique(FisheryType))
lft <- length(suft)
cft <- brewer.pal(lft, "Set3")
barplot(table(FisheryType, durationclass), col=cft, las=1, main="FisheryType and durationclass")
legend("topleft", suft, fill=cft)
cft <- rev(brewer.pal(lft, "Set3"))
barplot(table(FisheryType, durationclass), col=cft, las=1, main="FisheryType and durationclass")
legend("topleft", suft, fill=cft)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), las=1)
}
figu("Number of records (out of ", dim(dat)[1], ") in each ecoregion.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(durationclass), las=1, main="durationclass")
}
figu("Number of records (out of ", dim(dat)[1], ") in each duration class (number of months).", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType), las=1, main="FisheryType")
}
figu("Number of records (out of ", dim(dat)[1], ") in each fishery type.", h=4, w=4)
suft <- sort(unique(FisheryType))
lft <- length(suft)
cft <- rev(brewer.pal(lft, "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1)
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", dim(dat)[1], ") in each duration class (number of months) and fishery type.", h=4, w=4)
fig <- function() plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name))
figu("Relation between chlorophyll a and fish biomass density by species.")
fig <- function() plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
figu("Relation between chlorophyll a and fish biomass density by species.")
endrtf()
??color
ctl <- colr(Trophic.Level, "blue", "orange")
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
ctl <- ifelse(is.na(Trophic.Level), "", colr(Trophic.Level, "blue", "orange"))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
summary(Trophic.Level)
Trophic.Level[!is.na(Trophic.Level)]
Trophic.Level[!is.na(Trophic.Level)]
colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange"))
colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange"))
class(Trophic.Level)
colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange")
ctl <- rep("", nrec)
ctl[!is.na(Trophic.Level)] <- colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange")
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
nrec <- format(dim(dat)[1], big.mark=",")
ctl <- rep("", nrec)
ctl[!is.na(Trophic.Level)] <- colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange")
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
ctl <- rep("", dim(dat[1])
ctl[!is.na(Trophic.Level)] <- colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange")
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
ctl <- rep("", dim(dat[1]))
ctl[!is.na(Trophic.Level)] <- colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange")
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
ctl <- rep("", dim(dat)[1])
ctl[!is.na(Trophic.Level)] <- colr(Trophic.Level[!is.na(Trophic.Level)], "blue", "orange")
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=Common.Name[sel], col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
q()
# C:\JVA\Consult\Deines\ExploreChla.r
library(lubridate)
# read in the data
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.csv")
# make sure trophic level is interpreted as numbers (not characters)
dat$Trophic.Level <- as.numeric(dat$Trophic.Level)
# time span calculations
dat$BEG_DATE <- as.Date(dat$BEG_DATE, "%d-%b-%y")
dat$END_DATE <- as.Date(dat$END_DATE, "%d-%b-%y")
dat$duration <- as.numeric(dat$END_DATE - dat$BEG_DATE)
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
dat$durationclass <- cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("< 1", "1", "2-11", "12", ">12"))
dat$month <- ifelse(dat$durationclass=="1", month(dat$BEG_DATE + dat$duration/2), NA)
attach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(durationclass), las=1, xlab="Duration (# months)", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each duration class.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType), las=1, xlab="Fishery type", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each fishery type.", h=4, w=4)
suft <- sort(unique(FisheryType))
lft <- length(suft)
cft <- rev(brewer.pal(lft, "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
fig <- function() plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
figu("Relation between chlorophyll a and fish biomass density by species, on a log-log scale.  Fish species distinguished by symbol letters and colors.")
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=Common.Name[sel], col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
fig <- function() plot(Trophic.Level, best.chla.u, log="y", pch=Common.Name, col=as.factor(Common.Name))
figu("Relation between chlorophyll a and fish biomass density by species.")
endrtf()
#detach(dat)
?brew
??brew
display.brewer.all()
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.")
fig <- function() {
par(mar=c(4, 4, 1, 1)
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1)
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=round(Trophic.Level[sel]), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
fig <- function() {
par(mar=c(4, 4, 1, 1)
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=KG.Region, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregionphic level distinguished by symbol letters and colors.", h=6.5, w=6.5)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(durationclass), las=1, xlab="Duration (# months)", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each duration class.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType), las=1, xlab="Fishery type", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each fishery type.", h=4, w=4)
suft <- sort(unique(FisheryType))
lft <- length(suft)
cft <- rev(brewer.pal(lft, "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
endrtf()
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=round(Trophic.Level[sel]), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=KG.Region, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregionphic level distinguished by symbol letters and colors.", h=6.5, w=6.5)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(durationclass), las=1, xlab="Duration (# months)", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each duration class.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType), las=1, xlab="Fishery type", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each fishery type.", h=4, w=4)
suft <- sort(unique(FisheryType))
lft <- length(suft)
cft <- rev(brewer.pal(lft, "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
endrtf()
table(KG.Region)
sort(table(KG.Region))
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(durationclass), las=1, xlab="Duration (# months)", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each duration class.", h=4, w=4)
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType), las=1, xlab="Fishery type", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each fishery type.", h=4, w=4)
suft <- sort(unique(FisheryType))
lft <- length(suft)
cft <- rev(brewer.pal(lft, "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
endrtf()
#detach(dat)
head(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data.")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=4, w=4)
endrtf()
#detach(dat)
graphics.off()
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "blue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,"
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=4, w=4)
endrtf()
#detach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "blue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=4, w=4)
endrtf()
#detach(dat)
?color
??color
?colors
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=4, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=4, w=4)
endrtf()
#detach(dat)
# C:\JVA\Consult\Deines\ExploreChla.r
library(lubridate)
# read in the data
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.csv")
# make sure trophic level is interpreted as numbers (not characters)
dat$Trophic.Level <- as.numeric(dat$Trophic.Level)
# time span calculations
dat$BEG_DATE <- as.Date(dat$BEG_DATE, "%d-%b-%y")
dat$END_DATE <- as.Date(dat$END_DATE, "%d-%b-%y")
dat$duration <- as.numeric(dat$END_DATE - dat$BEG_DATE)
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
dat$durationclass <- cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("< 1", "1", "2-11", "12", ">12"))
dat$month <- ifelse(dat$durationclass=="1", month(dat$BEG_DATE + dat$duration/2), NA)
attach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3.5, w=4)
endrtf()
#detach(dat)
figu
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
addPageBreak()
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak()
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
addPageBreak()
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3.5, w=4)
endrtf()
#detach(dat)
library(rtf)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
addPageBreak()
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak()
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
addPageBreak()
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3.5, w=4)
endrtf()
#detach(dat)
?addPageBreak
?RTF
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
addPageBreak(doc)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3.5, w=4)
endrtf()
#detach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
addPageBreak(doc)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
?date
Sys.Date
Sys.Date()
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(Sys.Date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
addPageBreak(doc)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading("Jean V. Adams")
heading(Sys.Date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
addPageBreak(doc)
para("If you end up breaking the data into groups according to duration and fishery type, you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
cleanup()
q()
# C:\JVA\Consult\Deines\ExploreChla.r
library(lubridate)
library(rtf)
# read in the data
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.csv")
# make sure trophic level is interpreted as numbers (not characters)
dat$Trophic.Level <- as.numeric(dat$Trophic.Level)
# time span calculations
dat$BEG_DATE <- as.Date(dat$BEG_DATE, "%d-%b-%y")
dat$END_DATE <- as.Date(dat$END_DATE, "%d-%b-%y")
dat$duration <- as.numeric(dat$END_DATE - dat$BEG_DATE)
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
dat$durationclass <- cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("< 1", "1", "2-11", "12", ">12"))
dat$month <- ifelse(dat$durationclass=="1", month(dat$BEG_DATE + dat$duration/2), NA)
attach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading("Jean V. Adams")
heading(Sys.Date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"  It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(Trophic.Level[sel])), col=ctl, xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
fig <- function() {
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, col=mycol, las=1, xlab="Trophic level", ylab="Frequency")
}
figu("Distribution of trophic level values among all ", nrec, " records", h=4, w=5)
addPageBreak(doc)
para("If you divide the data into groups according to duration and fishery type (in order to conduct separate analyses),",
" you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, nclass=25, col=mycol, las=1, xlab="Trophic level", ylab="Frequency")
locator()
locator()
plot(sort(Trophic.Level))
locator()
q()
attach(dat)
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, nclass=25, col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
stem(Trophic.Level)
dotchart(Trophic.Level)
table(Trophic.Level)
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, breaks=seq(0.05, 10.05, 0.1), col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
range(Trophic.Level)
range(Trophic.Level, na.rm=TRUE)
rt <- range(Trophic.Level, na.rm=TRUE)
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, breaks=seq(rt[1]-0.05, rt[2]+0.05, 0.1), col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
search()
detach()
graphics.off()
# C:\JVA\Consult\Deines\ExploreChla.r
library(lubridate)
library(rtf)
# read in the data
dat <- read.csv("C:/JVA/Consult/Deines/master_harvest_chl_metadata.csv")
# make sure trophic level is interpreted as numbers (not characters)
dat$Trophic.Level <- as.numeric(dat$Trophic.Level)
# time span calculations
dat$BEG_DATE <- as.Date(dat$BEG_DATE, "%d-%b-%y")
dat$END_DATE <- as.Date(dat$END_DATE, "%d-%b-%y")
dat$duration <- as.numeric(dat$END_DATE - dat$BEG_DATE)
dat$jday <- as.numeric(format(dat$BEG_DATE, "%j"))
dat$durationclass <- cut(dat$duration, c(0, 15, 45, 350, 380, 400), c("< 1", "1", "2-11", "12", ">12"))
dat$month <- ifelse(dat$durationclass=="1", month(dat$BEG_DATE + dat$duration/2), NA)
attach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading("Jean V. Adams")
heading(Sys.Date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"  It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(2*Trophic.Level[sel])), col=ctl, 
xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers (2 times the level) and colors.", 
h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
rt <- range(Trophic.Level, na.rm=TRUE)
fig <- function() {
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, breaks=seq(rt[1]-0.05, rt[2]+0.05, 0.1), col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
}
figu("Distribution of trophic level values among all ", nrec, " records.", h=4, w=5)
addPageBreak(doc)
para("If you divide the data into groups according to duration and fishery type (in order to conduct separate analyses),",
" you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading("Jean V. Adams")
heading(Sys.Date(), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"  It looks like there's an awful lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(2*Trophic.Level[sel])), col=ctl, 
xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers (2 times the level) and colors.", 
h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Ecoregion distinguished by symbol letters and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=4, w=5)
rt <- range(Trophic.Level, na.rm=TRUE)
fig <- function() {
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, breaks=seq(rt[1]-0.05, rt[2]+0.05, 0.1), col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
}
figu("Distribution of trophic level values among all ", nrec, " records.", h=4, w=5)
addPageBreak(doc)
para("If you divide the data into groups according to duration and fishery type (in order to conduct separate analyses),",
" you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
heading
#' Add a Figure to an RTF Document
#'
#' Add a figure to an rtf (rich text format) document.
#' @param ... One or more character scalars (separated by commas) of text to use for the figure caption.
#' @param FIGA function to create a figure which will be added to the document, default \code{fig}.
#' @param rtfAn rtf object, default \code{doc}.
#' @param figid Character scalar of caption identifier, default "Figure ".
#' @param fign Numeric scalar of figure number to use in caption,, default \code{figcount}.
#' @param boldt Logical scalar indicating if figure number should use bold font, default TRUE.
#' @param capunder Logical scalar indicating if caption should appear under the figure (TRUE, the default) or on top of the figure (FALSE).
#' @param w Numeric scalar width of figure in inches, default 6.5.
#' @param h Numeric scalar height of figure in inches, default 8.
#' @param rf Numeric scalar resolution of figure, default 300.
#' @param newpage Character scalar indicating if the figure should start on a new page in the document "port" for a new portrait page,
#' "land" for a new landscape page, and "none" for no new page (the default).
#' @param omi Numeric vector, length 4, width of document page margins in inches (bottom, left, top, right), default c(1, 1, 1, 1).
#' @returnA 1 is added to the numeric vector of length 1, \code{figcount}, stored in the working directory to keep track
#' of the number of figures written to the rtf document, and label the captions accordingly.
#' @details The figure and caption are written to the rtf file.
#' The size of a new page is assumed to be 8.5 by 11 inches.
#' @seealso\code{\link[jvamisc]{startrtf}}, \code{\link[jvamisc]{heading}}, \code{\link[jvamisc]{para}}, \code{\link[jvamisc]{tabl}}, 
#' \code{\link[jvamisc]{figbig}}, \code{\link[jvamisc]{endrtf}}, \code{\link[rtf]{RTF}}.
#' @import rtf
#' @export
#' @examples 
#' \dontrun{
#' doc <- startrtf()
#' heading("Heading 1")
#' para("First paragraph.")
#' tab <- head(cars)
#' tabl("First few rows of cars data.", row.names=FALSE)
#' heading("Heading 2", 2)
#' para("Second paragraph.")
#' fig <- function() {
#' plot(cars)
#' lo <- loess(cars$dist ~ cars$speed)
#' lines(lo$x, lo$fitted)
#' }
#' figu("Speed vs. distance from the cars data.")
#' endrtf()
#' }
figu <- function(..., FIG=fig, rtf=doc, figid="Figure ", fign=figcount, boldt=TRUE, capunder=TRUE, w=NULL, h=NULL, rf=300, newpage="none", omi=c(1, 1, 1, 1)) {
wf <- if(is.null(w)) 6.5 else w
hf <- if(is.null(h)) 8 else h
if(newpage=="none") addNewLine(this=rtf)
if(newpage=="port") addPageBreak(this=rtf, width=8.5, height=11, omi=omi)
if(newpage=="land") {
wf <- if(is.null(w)) 9 else w
hf <- if(is.null(h)) 5.5 else h
addPageBreak(this=rtf, width=11, height=8.5, omi=omi)
}
if(capunder) {
addPlot(this=rtf, plot.fun=FIG, width=wf, height=hf, res=rf)
#addNewLine(this=rtf)
addNewLine(this=rtf)
}
startParagraph(this=rtf)
addText(this=rtf, paste0(figid, fign, ".  "), bold=boldt)
addText(this=rtf, ...)
endParagraph(this=rtf)
if(!capunder) {
addPlot(this=rtf, plot.fun=FIG, width=wf, height=hf, res=rf)
}
#addNewLine(this=rtf)
addNewLine(this=rtf)
figcount <<- fign + 1
}
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(paste("Jean V. Adams", Sys.Date(), sep="  -  ", 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"  It looks like there's a lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(2*Trophic.Level[sel])), col=ctl, 
xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers (two times the level) and colors.", 
h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.",
"  Ecoregion distinguished by symbol letters (the third character of the Df_ ecoregions were used) and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions and three groups of trophic levels (3.0-3.5, 3.5-4.0, and 4.0-4.5)")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=3.5, w=5)
rt <- range(Trophic.Level, na.rm=TRUE)
fig <- function() {
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, breaks=seq(rt[1]-0.05, rt[2]+0.05, 0.1), col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
}
figu("Distribution of trophic level values among all ", nrec, " records.", h=3.5, w=5)
addPageBreak(doc)
para("If you divide the data into groups according to duration and fishery type (in order to conduct separate analyses),",
" you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(paste("Jean V. Adams", Sys.Date(), sep="  -  "), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"  It looks like there's a lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(2*Trophic.Level[sel])), col=ctl, 
xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers (two times the level) and colors.", 
h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.",
"  Ecoregion distinguished by symbol letters (the third character of the Df_ ecoregions were used) and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions and three groups of trophic levels (3.0-3.5, 3.5-4.0, and 4.0-4.5)")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=3.5, w=5)
rt <- range(Trophic.Level, na.rm=TRUE)
fig <- function() {
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, breaks=seq(rt[1]-0.05, rt[2]+0.05, 0.1), col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
}
figu("Distribution of trophic level values among all ", nrec, " records.", h=3.5, w=5)
addPageBreak(doc)
para("If you divide the data into groups according to duration and fishery type (in order to conduct separate analyses),",
" you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
#' Add a Figure to an RTF Document
#'
#' Add a figure to an rtf (rich text format) document.
#' @param ... One or more character scalars (separated by commas) of text to use for the figure caption.
#' @param FIGA function to create a figure which will be added to the document, default \code{fig}.
#' @param rtfAn rtf object, default \code{doc}.
#' @param figid Character scalar of caption identifier, default "Figure ".
#' @param fign Numeric scalar of figure number to use in caption,, default \code{figcount}.
#' @param boldt Logical scalar indicating if figure number should use bold font, default TRUE.
#' @param capunder Logical scalar indicating if caption should appear under the figure (TRUE, the default) or on top of the figure (FALSE).
#' @param w Numeric scalar width of figure in inches, default 6.5.
#' @param h Numeric scalar height of figure in inches, default 8.
#' @param rf Numeric scalar resolution of figure, default 300.
#' @param newpage Character scalar indicating if the figure should start on a new page in the document "port" for a new portrait page,
#' "land" for a new landscape page, and "none" for no new page (the default).
#' @param omi Numeric vector, length 4, width of document page margins in inches (bottom, left, top, right), default c(1, 1, 1, 1).
#' @returnA 1 is added to the numeric vector of length 1, \code{figcount}, stored in the working directory to keep track
#' of the number of figures written to the rtf document, and label the captions accordingly.
#' @details The figure and caption are written to the rtf file.
#' The size of a new page is assumed to be 8.5 by 11 inches.
#' @seealso\code{\link[jvamisc]{startrtf}}, \code{\link[jvamisc]{heading}}, \code{\link[jvamisc]{para}}, \code{\link[jvamisc]{tabl}}, 
#' \code{\link[jvamisc]{figbig}}, \code{\link[jvamisc]{endrtf}}, \code{\link[rtf]{RTF}}.
#' @import rtf
#' @export
#' @examples 
#' \dontrun{
#' doc <- startrtf()
#' heading("Heading 1")
#' para("First paragraph.")
#' tab <- head(cars)
#' tabl("First few rows of cars data.", row.names=FALSE)
#' heading("Heading 2", 2)
#' para("Second paragraph.")
#' fig <- function() {
#' plot(cars)
#' lo <- loess(cars$dist ~ cars$speed)
#' lines(lo$x, lo$fitted)
#' }
#' figu("Speed vs. distance from the cars data.")
#' endrtf()
#' }
figu <- function(..., FIG=fig, rtf=doc, figid="Figure ", fign=figcount, boldt=TRUE, capunder=TRUE, w=NULL, h=NULL, rf=300, newpage="none", omi=c(1, 1, 1, 1)) {
wf <- if(is.null(w)) 6.5 else w
hf <- if(is.null(h)) 8 else h
if(newpage=="none") #addNewLine(this=rtf)
if(newpage=="port") addPageBreak(this=rtf, width=8.5, height=11, omi=omi)
if(newpage=="land") {
wf <- if(is.null(w)) 9 else w
hf <- if(is.null(h)) 5.5 else h
addPageBreak(this=rtf, width=11, height=8.5, omi=omi)
}
if(capunder) {
addPlot(this=rtf, plot.fun=FIG, width=wf, height=hf, res=rf)
#addNewLine(this=rtf)
addNewLine(this=rtf)
}
startParagraph(this=rtf)
addText(this=rtf, paste0(figid, fign, ".  "), bold=boldt)
addText(this=rtf, ...)
endParagraph(this=rtf)
if(!capunder) {
addPlot(this=rtf, plot.fun=FIG, width=wf, height=hf, res=rf)
}
#addNewLine(this=rtf)
addNewLine(this=rtf)
figcount <<- fign + 1
}
doc <- startrtf("Explore", "C:/JVA/Consult/Deines/")
mycol <- "skyblue"
nrec <- format(dim(dat)[1], big.mark=",")
heading("Explore Whitney and Andy's species-specific global inland fisheries data")
heading(paste("Jean V. Adams", Sys.Date(), sep="  -  "), 3)
para("I'm not sure what's going on with the graphs in your spreadsheet, but these graphs show a very different pattern between chlorphyll a and fish density.",
"  It looks like there's a lot of overlap among the different species and trophic levels.")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=Common.Name, col=as.factor(Common.Name), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Fish species distinguished by symbol letters and colors.", h=6.5, w=6.5)
sel <- !is.na(Trophic.Level)
ctl <- colr(Trophic.Level[sel], "blue", "orange")
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u[sel], FISH_PROD_KG_HA[sel], log="xy", pch=as.character(round(2*Trophic.Level[sel])), col=ctl, 
xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.  Trophic level distinguished by symbol numbers (two times the level) and colors.", 
h=6.5, w=6.5)
addPageBreak(doc)
para("There seems to be a bit more separation among the ecoregions, at least on the chlorophyll a scale.")
per <- substr(KG.Region, 1, 1)
per[substr(KG.Region, 1, 2)=="Df"] <- substring(KG.Region, 3, 3)[substr(KG.Region, 1, 2)=="Df"]
fig <- function() {
par(mar=c(4, 4, 1, 1))
plot(best.chla.u, FISH_PROD_KG_HA, log="xy", pch=per, col=as.factor(KG.Region), xlab="Chlorophyll a  (ug/L)", ylab="Fish density  (kg/ha)")
}
figu("Relation between chlorophyll a and fish biomass density, on a log-log scale.",
"  Ecoregion distinguished by symbol letters (the third character of the Df_ ecoregions were used) and colors.", h=6.5, w=6.5)
addPageBreak(doc)
para("Most of the data fell into four ecoregions and three groups of trophic levels (3.0-3.5, 3.5-4.0, and 4.0-4.5)")
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(KG.Region), col=mycol, las=1, xlab="Ecoregion", ylab="Frequency")
}
figu("Number of records (out of ", nrec, ") in each ecoregion.", h=3.5, w=5)
rt <- range(Trophic.Level, na.rm=TRUE)
fig <- function() {
par(mar=c(4, 4, 1, 1))
hist(Trophic.Level, breaks=seq(rt[1]-0.05, rt[2]+0.05, 0.1), col=mycol, las=1, xlab="Trophic level", ylab="Frequency", main="")
}
figu("Distribution of trophic level values among all ", nrec, " records.", h=3.5, w=5)
addPageBreak(doc)
para("If you divide the data into groups according to duration and fishery type (in order to conduct separate analyses),",
" you'd end up with two groups based on one year of data,",
" and perhaps five groups based on one month of data (May - Sep).")
suft <- sort(unique(FisheryType))
cft <- rev(brewer.pal(length(suft), "Set3"))
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(FisheryType, durationclass), col=cft, las=1, xlab="Duration (# months)", ylab="Frequency")
legend("topleft", suft, fill=cft, title="Fishery type")
}
figu("Number of records (out of ", nrec, ") in each duration class (number of months) and fishery type.", h=3.5, w=4)
sel <- durationclass=="1"
fig <- function() {
par(mar=c(4, 4, 1, 1))
barplot(table(month[sel]), col=mycol, las=1, xlab="Month", ylab="Frequency")
}
figu("Number of records (out of ", sum(sel), " in the 1-month duration class) in each month.", h=3, w=4)
endrtf()
#detach(dat)
cleanup()
q()
library(devtools)
library(roxygen2)
setwd("C:/JVA/GitHub")
install("jvamisc")
setwd("C:/JVA/R/Working Directory")
library(jvamisc)
library(devtools)
setwd("C:/JVA/GitHub/jvamisc")
document()
q()
