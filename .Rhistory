get.packages(c("XLConnect", "MASS", "vegan")) #, "Matrix", "rJava", "mgcv", "lme4", "car"))
rm(get.packages)
d <- vegdist(all[, -(1:3)], method="jaccard") 
dim(d)
class(d)
length(d)
fit <- isoMDS(d, k=2) # k is the number of dim
fit # view results
table(all$X1, all$X2)
table(all[, 1], all[, 3])
table(all[1, ], all[3, ])
all[1, ]
all[3, ]
?isoMDS
duplicated(all[, -(1:3)])
?duplicated
head(all)
bignum <- paste(all[, -(1:3)]
paste(names(all[, -(1:3)]), sep=", ")
paste(names(all[, -(1:3)]), sep=", ")
paste(names(all[, -(1:3)]), collapse=", ")
paste0("paste(",paste0(names(all[, -(1:3)]), collapse=", "))
paste0("paste(",paste0(names(all[, -(1:3)]), collapse=", "), ")")
eval(paste0("paste(",paste0(names(all[, -(1:3)]), collapse=", "), ")"))
?eval
?parse
eval(paste0("paste(",paste0(names(all[, -(1:3)]), collapse=", "), ")"))
eval(parse(text=paste0("paste(",paste0(names(all[, -(1:3)]), collapse=", "), ")")))
with(all, eval(parse(text=paste0("paste(",paste0(names(all[, -(1:3)]), collapse=", "), ")"))))
with(all, eval(parse(text=paste0("paste0(", paste0(names(all[, -(1:3)]), collapse=", "), ")"))))
all$bignum <- with(all, eval(parse(text=paste0("paste0(", paste0(names(all[, -(1:3)]), collapse=", "), ")"))))
allo <- all[order(all$bignum), ]
allo$dup <- duplicated(allo$bignum)
head(allo)
head(allo[, c("beach", "episode", "fingerid", "bignum", "dup")])
last
last(allo$dup)
all$bignum <- with(all, eval(parse(text=paste0("paste0(", paste0(names(all[, -(1:3)]), collapse=", "), ")"))))
allo <- all[order(all$bignum, all$beach, all$episode, all$fingerid), ]
allo$dup <- duplicated(allo$bignum)
head(allo[, c("beach", "episode", "fingerid", "bignum", "dup")])
allo$lastid <- dimnames(allo)[1][last(allo$dup)==1 & !allo$dup]
dimnames(allo)[[1]][last(allo$dup)==1 & !allo$dup]
lastid <- ifelse(last(allo$dup)==1 & !allo$dup, dimnames(allo)[[1]], NA)
lastid
fill
all$bignum <- with(all, eval(parse(text=paste0("paste0(", paste0(names(all[, -(1:3)]), collapse=", "), ")"))))
allo <- all[order(all$bignum, all$beach, all$episode, all$fingerid), ]
allo$dup <- duplicated(allo$bignum)
head(allo[, c("beach", "episode", "fingerid", "bignum", "dup")])
lastid <- ifelse(last(allo$dup)==1 & !allo$dup, dimnames(allo)[[1]], NA)
lastid <- fill(lastid)
sameas <- ifelse(allo$dup, lastid, NA)
# read in the data ... mesh 153 v285
wb <- loadWorkbook("C:/JVA/Consult/Przybyla-Kelly/Ecolistrains/Binary ALL beaches.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[1])
rm(wb)
# transpose the data
tdat <- t(dat)
namz <- dimnames(tdat)[[1]]
spnamz <- strsplit(namz, "_")
spnamz1 <- sapply(spnamz, "[", 1)
nc <- nchar(spnamz1)
beach <- substring(spnamz1, 1, nc-1)
episode <- as.numeric(substring(spnamz1, nc, nc))
spnamz2 <- sapply(spnamz, "[", 2)
fingerid <- as.numeric(spnamz2)
all <- data.frame(beach, episode, fingerid, tdat)
rm(dat, tdat, namz, spnamz, spnamz1, nc, beach, episode, spnamz2, fingerid)
dim(all)
head(all)
all$bignum <- with(all, eval(parse(text=paste0("paste0(", paste0(names(all[, 4:34]), collapse=", "), ")"))))
allo <- all[order(all$bignum, all$beach, all$episode, all$fingerid), ]
allo$dup <- duplicated(allo$bignum)
head(allo[, c("beach", "episode", "fingerid", "bignum", "dup")])
lastid <- ifelse(last(allo$dup)==1 & !allo$dup, dimnames(allo)[[1]], NA)
lastid <- fill(lastid)
sameas <- ifelse(allo$dup, lastid, NA)
allo2 <- cbind(allo, sameas)
head(allo2)
# figure out duplicates
all$bignum <- with(all, eval(parse(text=paste0("paste0(", paste0(names(all[, 4:34]), collapse=", "), ")"))))
allo <- all[order(all$bignum, all$beach, all$episode, all$fingerid), ]
allo$dup <- duplicated(allo$bignum)
head(allo[, c("beach", "episode", "fingerid", "bignum", "dup")])
lastid <- ifelse(last(allo$dup)==1 & !allo$dup, dimnames(allo)[[1]], NA)
lastid <- fill(lastid)
allo$sameas <- ifelse(allo$dup, lastid, "")
rm(lastid)
head(allo)
allo[allo$dup, ]
allo[allo$dup, ]
allo[allo$dup, c("beach", "episode", "fingerid", "bignum", "dup")]
allo[allo$dup, c("beach", "episode", "fingerid", "bignum", "dup", "sameas")]
table(allo$dup)
d <- vegdist(all[, 4:34], method="jaccard") 
d
vegdist(all[1:5, 4:10], method="jaccard") 
all[1:5, 4:10]
vegdist(all[1:4, 7:10], method="jaccard") 
vegdist(all[1:4, 7:10], method="jaccard")  + 0.001
d <- vegdist(all[, 4:34], method="jaccard") 
fit <- isoMDS(d+0.0001, k=2) # k is the number of dim
fit # view results
# plot solution 
x <- fit$points[,1]
y <- fit$points[,2]
plot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Nonmetric MDS", type="n")
text(x, y, labels = row.names(all), cex=.7)
table(allo$beach)
as.factor(allo$beach)
# non-metric multidimensional scaling 
d <- vegdist(all[, 4:34], method="jaccard") 
# because there are some zero distances, and isoMDS wants all positives, I added a small distance to the zeroes
fit <- isoMDS(d+0.0001, k=2) # k is the number of dim
# plot solution 
x <- fit$points[,1]
y <- fit$points[,2]
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
sub <- sort(unique(allo$beach))
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
# plot solution 
x <- fit$points[,1]
y <- fit$points[,2]
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nEpisode symbols, Beach colors", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
sue <- sort(unique(allo$episode))
windows()
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nBeach symbols, Episode colors", type="n")
text(x, y, labels=substring(allo$beach, 1, 1), col=match(allo$episode, sue), cex=.7)
a <- table(allo$beach, allo$episode, allo$fingerid)
dim(a)
dim(allo)
1117/20
windows()
hist(allo$fingerid)
hist(allo$fingerid, nclass=300)
head(allo)
allo[allo$fingerid==106, ]
a <- table(paste(allo$beach, allo$episode), allo$fingerid)
dim(a)
a <- table(allo$fingerid, paste(allo$beach, allo$episode))
dim(a)
a
a[1:30, 1:10]
a <- table(allo$fingerid, paste0(substring(allo$beach, 1, 1), allo$episode))
a
table(allo$beach, allo$episode)
# because there are some zero distances, and isoMDS wants all positives, I added a small distance to the zeroes
smalld <- 0.0000001
fit <- isoMDS(d+smalld, k=2) # k is the number of dim
# plot solution 
x <- fit$points[,1]
y <- fit$points[,2]
windows()
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nEpisode symbols, Beach colors", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
windows()
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nBeach symbols, Episode colors", type="n")
text(x, y, labels=substring(allo$beach, 1, 1), col=match(allo$episode, sue), cex=.7)
i <- 1
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nEpisode symbols, Beach colors", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
hpts <- chull(x, y)
hpts
sel <- chull(x, y)
lines(x[sel], y[sel], col=i)
sel <- chull(x, y)
polygon(x[sel], y[sel], dens=0, col=i)
for(i in seq(sub)) {
sel <- chull(x, y)
polygon(x[sel], y[sel], dens=0, col=i)
}
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nEpisode symbols, Beach colors", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
for(i in seq(sub)) {
sel <- allo$beach==sub[i]
hull <- chull(x, y)
polygon(x[hull], y[hull], dens=0, col=i)
}
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nEpisode symbols, Beach colors", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
for(i in seq(sub)) {
sel <- allo$beach==sub[i]
hull <- chull(x[sel], y[sel])
polygon(x[sel][hull], y[sel][hull], dens=0, col=i)
}
windows()
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nEpisode symbols, Beach colors", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
for(i in seq(sub)) {
sel <- allo$beach==sub[i]
hull <- chull(x[sel], y[sel])
polygon(x[sel][hull], y[sel][hull], dens=0, col=i)
}
windows()
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nBeach symbols, Episode colors", type="n")
text(x, y, labels=substring(allo$beach, 1, 1), col=match(allo$episode, sue), cex=.7)
for(i in seq(sue)) {
sel <- allo$episode==sue[i]
hull <- chull(x[sel], y[sel])
polygon(x[sel][hull], y[sel][hull], dens=0, col=i)
}
allo[allo$dup, c("beach", "episode", "fingerid", "bignum", "dup", "sameas")]
allo[allo$dup, c("beach", "episode", "fingerid", "bignum", "dup", "sameas")]
allo[allo$dup, c("beach", "episode", "fingerid", "bignum", "sameas")]
dim(allo[allo$dup, c("beach", "episode", "fingerid", "bignum", "sameas")])
dim(allo)
table(allo$dup)
allo[allo$dup, c("beach", "episode", "fingerid", "bignum", "sameas")][1:20, ]
allo[allo$dup, c("bignum", "sameas")][1:20, ]
allo[allo$sameas=="X63rd3_127", c("bignum", "sameas")]
graphics.off()
y
cleanup()
search()
# C:\JVA\Consult\Przybyla-Kelly\Ecolistrains\Similarity.r
get.packages <- function(want) {
# install (if necessary) and attach wanted packages
have <- row.names(installed.packages())
need <- want[!(want %in% have)]
if(length(need)>0) install.packages(need, repos="http://cran.r-project.org")
lapply(want, require, character.only=TRUE)
invisible()
}
last <- function(x) {
    y <- rev(x)
    l <- length(y)
    rev(c(1, 1-(y[-1]==y[-l])))
    }
fill <- function(x) {
# fill in a vector of values
# assign to every NA or "" the last value for the vector
y <- x
last <- x[1]
if(is.character(x)){
for(i in 2:length(x))
if(x[i]=="" | is.na(x[i])) y[i] <- last else last <- x[i]
} else {
for(i in 2:length(x))
if(is.na(x[i])) y[i] <- last else last <- x[i]
}
y
}
### needed R packages
get.packages(c("XLConnect", "MASS", "vegan")) #, "Matrix", "rJava", "mgcv", "lme4", "car"))
rm(get.packages)
# read in the data ... mesh 153 v285
wb <- loadWorkbook("C:/JVA/Consult/Przybyla-Kelly/Ecolistrains/Binary ALL beaches.xlsx")
dat <- readWorksheet(wb, sheet=getSheets(wb)[1])
rm(wb)
# transpose the data
tdat <- t(dat)
namz <- dimnames(tdat)[[1]]
spnamz <- strsplit(namz, "_")
spnamz1 <- sapply(spnamz, "[", 1)
nc <- nchar(spnamz1)
beach <- substring(spnamz1, 1, nc-1)
episode <- as.numeric(substring(spnamz1, nc, nc))
spnamz2 <- sapply(spnamz, "[", 2)
number <- as.numeric(spnamz2)
all <- data.frame(beach, episode, number, tdat)
rm(dat, tdat, namz, spnamz, spnamz1, nc, beach, episode, spnamz2, number)
# figure out duplicates
all$fingerprint <- with(all, eval(parse(text=paste0("paste0(", paste0(names(all[, 4:34]), collapse=", "), ")"))))
allo <- all[order(all$fingerprint, all$beach, all$episode, all$number), ]
allo$dup <- duplicated(allo$fingerprint)
head(allo[, c("beach", "episode", "number", "fingerprint", "dup")])
lastid <- ifelse(last(allo$dup)==1 & !allo$dup, dimnames(allo)[[1]], NA)
lastid <- fill(lastid)
allo$sameas <- ifelse(allo$dup, lastid, "")
rm(lastid)
allo[allo$dup, c("fingerprint", "sameas")][1:20, ]
sub <- sort(unique(allo$beach))
sue <- sort(unique(allo$episode))
# non-metric multidimensional scaling 
d <- vegdist(all[, 4:34], method="jaccard") 
# because there are some zero distances, and isoMDS wants all positives, I added a small distance to the zeroes
smalld <- 0.0000001
fit <- isoMDS(d+smalld, k=2) # k is the number of dim
# plot solution 
x <- fit$points[,1]
y <- fit$points[,2]
windows()
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nEpisode symbols, Beach colors", type="n")
text(x, y, labels=allo$episode, col=match(allo$beach, sub), cex=.7)
for(i in seq(sub)) {
sel <- allo$beach==sub[i]
hull <- chull(x[sel], y[sel])
polygon(x[sel][hull], y[sel][hull], dens=0, col=i)
}
windows()
eqscplot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Non-metric multidimensional scaling\nBeach symbols, Episode colors", type="n")
text(x, y, labels=substring(allo$beach, 1, 1), col=match(allo$episode, sue), cex=.7)
for(i in seq(sue)) {
sel <- allo$episode==sue[i]
hull <- chull(x[sel], y[sel])
polygon(x[sel][hull], y[sel][hull], dens=0, col=i)
}
cleanup()
q()
c(3.78, 6.89, 12.58) %*% c(0.13, 0.07, 0.19)
c(3.78, 6.89, 12.58) %**% c(0.13, 0.07, 0.19)
?outer
c(3.78, 6.89, 12.58) %o% c(0.13, 0.07, 0.19)
c(3.78, 6.89, 12.58) %o% c(0.07, 0.13, 0.19)
hist(c(3.78, 6.89, 12.58) %o% c(0.07, 0.13, 0.19))
hist(c(3.78, 6.89, 12.58) %o% c(0.07, 0.13, 0.19), nclass=9)
hist(c(3.78, 6.89, 12.58) %o% c(0.07, 0.13, 0.19), nclass=9, col="blue)
hist(c(3.78, 6.89, 12.58) %o% c(0.07, 0.13, 0.19), nclass=9, col="blue")
lognorm
rlognorm
rlnorm
log(c(3.78, 6.89, 12.58))
log(c(3.78, 6.89, 12.58))[2]
a <- log(c(3.78, 6.89, 12.58))
a[2] - a[1]
(a[2] - a[1])/2
a <- rnorm(100, 1.93, 0.3)
b <- rnorm(100, 0.13, 0.03)
a
b
a*b
exp(a)*b
CI(exp(a)*b)
nsim <- 100
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
CI(a*b)
nsim <- 100
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
CI(a*b)
nsim <- 100
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
CI(a*b)
nsim <- 100
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
CI(a*b)
nsim <- 10000
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
quantile(a*b, c(0.025, 0.5, 0.975))
nsim <- 10000
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
quantile(a*b, c(0.025, 0.5, 0.975))
nsim <- 10000
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
quantile(a*b, c(0.025, 0.5, 0.975))
nsim <- 10000
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
quantile(a*b, c(0.025, 0.5, 0.975))
nsim <- 10000
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
quantile(a*b, c(0.025, 0.5, 0.975))
nsim <- 10000
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
quantile(a*b, c(0.025, 0.5, 0.975))
nsim <- 1000000
a <- exp(rnorm(nsim, log(6.89), (log(12.58) - log(6.89)) / 2))
b <- rnorm(nsim, 0.13, (0.19 - 0.13) / 2)
quantile(a*b, c(0.025, 0.5, 0.975))
cleanup()
q()
l <- c(0.11, 0.64, and 0.25)
l <- c(0.11, 0.64, 0.25)
y <- c(0.26, 0.42, 0.32)
plot(l, y)
eqscplot(l, y)
eqscplot(l, y, type="n")
text(l, y, "W", cex=2, font=2)
windows()
par(mar=c(4, 4, 2, 1), cex=1.5)
eqscplot(l, y, type="n")
text(l, y, "W", font=2)
windows()
par(mar=c(4, 4, 2, 1), cex=1.5)
eqscplot(l, y, type="n", las=1, xlab="Maumee River larvae", ylab="Lake Erie yearlings", main="Year Class Strength")
text(l, y, "W", font=2)
points(l, y, pt.cex=0, type="o")
l <- c(0.11, 0.64, 0.25)
y <- c(0.26, 0.42, 0.32)
lord <- order(l)
windows()
par(mar=c(4, 4, 2, 1), cex=1.5)
eqscplot(l, y, type="n", las=1, xlab="Maumee River larvae", ylab="Lake Erie yearlings", main="Year Class Strength")
points(l[lord], y[lord], pt.cex=0, type="o")
text(l, y, "W", font=2)
l <- c(0.11, 0.64, 0.25)
y <- c(0.26, 0.42, 0.32)
lord <- order(l)
windows()
par(mar=c(4, 4, 2, 1), cex=1.5)
eqscplot(l, y, type="n", las=1, xlab="Maumee River larvae", ylab="Lake Erie yearlings", main="Year Class Strength")
points(l[lord], y[lord], cex=0, type="o")
text(l, y, "W", font=2)
abline(0, 1, lty=2)
l <- c(0.11, 0.64, 0.25)
y <- c(0.26, 0.42, 0.32)
xyr <- range(l, y)
lord <- order(l)
windows()
par(mar=c(4, 4, 2, 1), cex=1.5, pty="s")
plot(l, y, type="n", las=1, xlim=xyr, ylim=xyr, xlab="Maumee River larvae", ylab="Lake Erie yearlings", main="Year Class Strength")
lines(l[lord], y[lord])
text(l, y, "W", font=2)
abline(0, 1, lty=2)
cleanup()
q()
utils:::menuInstallPkgs()
library(dismo)
?brt
?gbm
?gbm.step
data(Anguilla_train)
# reduce data set to speed things up a bit
Anguilla_train = Anguilla_train[1:200,]
angaus.tc5.lr01 <- gbm.step(data=Anguilla_train, gbm.x = 3:14, gbm.y = 2, family = "bernoulli",
       tree.complexity = 5, learning.rate = 0.01, bag.fraction = 0.5)
a <- angaus.tc5.lr01
length(a)
names(a)
grep("call", names(a))
a[[34]]
a[[37]]
windows()
plot(a[[37]])
gbm.step
a[[33]]
a[[34]]
cleanup()
q()
calc.deviance
library(dismo)
calc.deviance
?calc.deviance
cleanup()
q()
install.packages("devtools")
library("devtools")
devtools::install_github("klutometis/roxygen")
library(roxygen2)
utils:::menuInstallPkgs()
find_rtools()
search()
cleanup()
q()
install.packages("devtools")
# download and install Rtools 3.1 from http://cran.r-project.org/bin/windows/Rtools/ and then run find_rtools().
library("devtools")
devtools::install_github("klutometis/roxygen")
library(roxygen2)
?setwd
getwd("parent_directory")
getwd()
create("jvamisc")
getwd()
setwd("./jvamisc")
document()
setwd("..")
install("jvamisc")
?added.var
added.var(Y=mtcars$hp, X=mtcars[, c("mpg", "disp", "wt")], main="Predicting horsepower from MPG, displacement, and weight")
added.var
find("added.var")
??added
file.path(R.home(), "doc/KEYWORDS")’
file.path(R.home(), "doc/KEYWORDS")
search()
detach(2)
setwd("./jvamisc")
document()
setwd("..")
install("jvamisc")
??hplot
?hplot
??added
?added.var
search()
detach(2)
search()
setwd("./jvamisc")
document()
setwd("..")
install("jvamisc")
?added.var
cleanup()
q()
getwd()
library("devtools")
library(roxygen2)
install("jvamisc")
?added.var
search()
library(jvamisc)
?added.var
ls(7)
mapproject
?jvamisc
?added.var
setwd("./jvamisc")
document()
cleanup()
q()
